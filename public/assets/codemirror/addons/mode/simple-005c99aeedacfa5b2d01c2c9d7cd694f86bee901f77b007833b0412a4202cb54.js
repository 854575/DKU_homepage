!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";function e(t,e){if(!t.hasOwnProperty(e))throw new Error("Undefined state "+e+" in simple mode")}function n(t,e){if(!t)return/(?:)/;var n="";return t instanceof RegExp?(t.ignoreCase&&(n="i"),t=t.source):t=String(t),new RegExp((e===!1?"":"^")+"(?:"+t+")",n)}function i(t){if(!t)return null;if("string"==typeof t)return t.replace(/\./g," ");for(var e=[],n=0;n<t.length;n++)e.push(t[n]&&t[n].replace(/\./g," "));return e}function r(t,r){(t.next||t.push)&&e(r,t.next||t.push),this.regex=n(t.regex),this.token=i(t.token),this.data=t}function s(t,e){return function(n,i){if(i.pending){var r=i.pending.shift();return 0==i.pending.length&&(i.pending=null),n.pos+=r.text.length,r.token}if(i.local){if(i.local.end&&n.match(i.local.end)){var s=i.local.endToken||null;return i.local=i.localState=null,s}var o,s=i.local.mode.token(n,i.localState);return i.local.endScan&&(o=i.local.endScan.exec(n.current()))&&(n.pos=n.start+o.index),s}for(var l=t[i.state],c=0;c<l.length;c++){var u=l[c],d=(!u.data.sol||n.sol())&&n.match(u.regex);if(d){if(u.data.next?i.state=u.data.next:u.data.push?((i.stack||(i.stack=[])).push(i.state),i.state=u.data.push):u.data.pop&&i.stack&&i.stack.length&&(i.state=i.stack.pop()),u.data.mode&&a(e,i,u.data.mode,u.token),u.data.indent&&i.indent.push(n.indentation()+e.indentUnit),u.data.dedent&&i.indent.pop(),d.length>2){i.pending=[];for(var h=2;h<d.length;h++)d[h]&&i.pending.push({text:d[h],token:u.token[h-1]});return n.backUp(d[0].length-(d[1]?d[1].length:0)),u.token[0]}return u.token&&u.token.join?u.token[0]:u.token}}return n.next(),null}}function o(t,e){if(t===e)return!0;if(!t||"object"!=typeof t||!e||"object"!=typeof e)return!1;var n=0;for(var i in t)if(t.hasOwnProperty(i)){if(!e.hasOwnProperty(i)||!o(t[i],e[i]))return!1;n++}for(var i in e)e.hasOwnProperty(i)&&n--;return 0==n}function a(e,i,r,s){var a;if(r.persistent)for(var l=i.persistentStates;l&&!a;l=l.next)(r.spec?o(r.spec,l.spec):r.mode==l.mode)&&(a=l);var c=a?a.mode:r.mode||t.getMode(e,r.spec),u=a?a.state:t.startState(c);r.persistent&&!a&&(i.persistentStates={mode:c,spec:r.spec,state:u,next:i.persistentStates}),i.localState=u,i.local={mode:c,end:r.end&&n(r.end),endScan:r.end&&r.forceEnd!==!1&&n(r.end,!1),endToken:s&&s.join?s[s.length-1]:s}}function l(t,e){for(var n=0;n<e.length;n++)if(e[n]===t)return!0}function c(e,n){return function(i,r,s){if(i.local&&i.local.mode.indent)return i.local.mode.indent(i.localState,r,s);if(null==i.indent||i.local||n.dontIndentStates&&l(i.state,n.dontIndentStates)>-1)return t.Pass;var o=i.indent.length-1,a=e[i.state];t:for(;;){for(var c=0;c<a.length;c++){var u=a[c];if(u.data.dedent&&u.data.dedentIfLineStart!==!1){var d=u.regex.exec(r);if(d&&d[0]){o--,(u.next||u.push)&&(a=e[u.next||u.push]),r=r.slice(d[0].length);continue t}}}break}return o<0?0:i.indent[o]}}t.defineSimpleMode=function(e,n){t.defineMode(e,function(e){return t.simpleMode(e,n)})},t.simpleMode=function(n,i){e(i,"start");var o={},a=i.meta||{},l=!1;for(var u in i)if(u!=a&&i.hasOwnProperty(u))for(var d=o[u]=[],h=i[u],f=0;f<h.length;f++){var p=h[f];d.push(new r(p,i)),(p.indent||p.dedent)&&(l=!0)}var g={startState:function(){return{state:"start",pending:null,local:null,localState:null,indent:l?[]:null}},copyState:function(e){var n={state:e.state,pending:e.pending,local:e.local,localState:null,indent:e.indent&&e.indent.slice(0)};e.localState&&(n.localState=t.copyState(e.local.mode,e.localState)),e.stack&&(n.stack=e.stack.slice(0));for(var i=e.persistentStates;i;i=i.next)n.persistentStates={mode:i.mode,spec:i.spec,state:i.state==e.localState?n.localState:t.copyState(i.mode,i.state),next:n.persistentStates};return n},token:s(o,n),innerMode:function(t){return t.local&&{mode:t.local.mode,state:t.localState}},indent:c(o,a)};if(a)for(var m in a)a.hasOwnProperty(m)&&(g[m]=a[m]);return g}});