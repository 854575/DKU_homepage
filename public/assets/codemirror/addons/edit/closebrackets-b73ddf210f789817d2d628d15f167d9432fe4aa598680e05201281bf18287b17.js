!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){function e(t,e){return"pairs"==e&&"string"==typeof t?t:"object"==typeof t&&null!=t[e]?t[e]:u[e]}function n(t){return function(e){return o(e,t)}}function i(t){var e=t.state.closeBrackets;if(!e)return null;var n=t.getModeAt(t.getCursor());return n.closeBrackets||e}function s(n){var s=i(n);if(!s||n.getOption("disableInput"))return t.Pass;for(var r=e(s,"pairs"),a=n.listSelections(),o=0;o<a.length;o++){if(!a[o].empty())return t.Pass;var l=c(n,a[o].head);if(!l||r.indexOf(l)%2!=0)return t.Pass}for(var o=a.length-1;o>=0;o--){var d=a[o].head;n.replaceRange("",h(d.line,d.ch-1),h(d.line,d.ch+1),"+delete")}}function r(n){var s=i(n),r=s&&e(s,"explode");if(!r||n.getOption("disableInput"))return t.Pass;for(var a=n.listSelections(),o=0;o<a.length;o++){if(!a[o].empty())return t.Pass;var l=c(n,a[o].head);if(!l||r.indexOf(l)%2!=0)return t.Pass}n.operation(function(){n.replaceSelection("\n\n",null),n.execCommand("goCharLeft"),a=n.listSelections();for(var t=0;t<a.length;t++){var e=a[t].head.line;n.indentLine(e,null,!0),n.indentLine(e+1,null,!0)}})}function a(e){var n=t.cmpPos(e.anchor,e.head)>0;return{anchor:new h(e.anchor.line,e.anchor.ch+(n?-1:1)),head:new h(e.head.line,e.head.ch+(n?1:-1))}}function o(n,s){var r=i(n);if(!r||n.getOption("disableInput"))return t.Pass;var o=e(r,"pairs"),c=o.indexOf(s);if(c==-1)return t.Pass;for(var u,f=e(r,"triples"),p=o.charAt(c+1)==s,g=n.listSelections(),m=c%2==0,v=0;v<g.length;v++){var _,y=g[v],b=y.head,x=n.getRange(b,h(b.line,b.ch+1));if(m&&!y.empty())_="surround";else if(!p&&m||x!=s)if(p&&b.ch>1&&f.indexOf(s)>=0&&n.getRange(h(b.line,b.ch-2),b)==s+s&&(b.ch<=2||n.getRange(h(b.line,b.ch-3),h(b.line,b.ch-2))!=s))_="addFour";else if(p){if(t.isWordChar(x)||!d(n,b,s))return t.Pass;_="both"}else{if(!m||n.getLine(b.line).length!=b.ch&&!l(x,o)&&!/\s/.test(x))return t.Pass;_="both"}else _=f.indexOf(s)>=0&&n.getRange(b,h(b.line,b.ch+3))==s+s+s?"skipThree":"skip";if(u){if(u!=_)return t.Pass}else u=_}var w=c%2?o.charAt(c-1):s,C=c%2?s:o.charAt(c+1);n.operation(function(){if("skip"==u)n.execCommand("goCharRight");else if("skipThree"==u)for(var t=0;t<3;t++)n.execCommand("goCharRight");else if("surround"==u){for(var e=n.getSelections(),t=0;t<e.length;t++)e[t]=w+e[t]+C;n.replaceSelections(e,"around"),e=n.listSelections().slice();for(var t=0;t<e.length;t++)e[t]=a(e[t]);n.setSelections(e)}else"both"==u?(n.replaceSelection(w+C,null),n.triggerElectric(w+C),n.execCommand("goCharLeft")):"addFour"==u&&(n.replaceSelection(w+w+w+w,"before"),n.execCommand("goCharRight"))})}function l(t,e){var n=e.lastIndexOf(t);return n>-1&&n%2==1}function c(t,e){var n=t.getRange(h(e.line,e.ch-1),h(e.line,e.ch+1));return 2==n.length?n:null}function d(e,n,i){var s=e.getLine(n.line),r=e.getTokenAt(n);if(/\bstring2?\b/.test(r.type))return!1;var a=new t.StringStream(s.slice(0,n.ch)+i+s.slice(n.ch),4);for(a.pos=a.start=r.start;;){var o=e.getMode().token(a,r.state);if(a.pos>=n.ch+1)return/\bstring2?\b/.test(o);a.start=a.pos}}var u={pairs:"()[]{}''\"\"",triples:"",explode:"[]{}"},h=t.Pos;t.defineOption("autoCloseBrackets",!1,function(e,n,i){i&&i!=t.Init&&(e.removeKeyMap(p),e.state.closeBrackets=null),n&&(e.state.closeBrackets=n,e.addKeyMap(p))});for(var f=u.pairs+"`",p={Backspace:s,Enter:r},g=0;g<f.length;g++)p["'"+f.charAt(g)+"'"]=n(f.charAt(g))});