function getFile(t,e){postMessage({type:"getFile",name:t,id:++nextId}),pending[nextId]=e}function startServer(t,e,n){n&&importScripts.apply(null,n),server=new tern.Server({getFile:getFile,async:!0,defs:t,plugins:e})}var server;this.onmessage=function(t){var e=t.data;switch(e.type){case"init":return startServer(e.defs,e.plugins,e.scripts);case"add":return server.addFile(e.name,e.text);case"del":return server.delFile(e.name);case"req":return server.request(e.body,function(t,n){postMessage({id:e.id,body:n,err:t&&String(t)})});case"getFile":var n=pending[e.id];return delete pending[e.id],n(e.err,e.text);default:throw new Error("Unknown message type: "+e.type)}};var nextId=0,pending={};this.console={log:function(t){postMessage({type:"debug",message:t})}};