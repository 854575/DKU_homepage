!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";function e(e,n){function i(e){return r.parentNode?(r.style.top=Math.max(0,e.clientY-r.offsetHeight-5)+"px",void(r.style.left=e.clientX+5+"px")):t.off(document,"mousemove",i)}var r=document.createElement("div");return r.className="CodeMirror-lint-tooltip",r.appendChild(n.cloneNode(!0)),document.body.appendChild(r),t.on(document,"mousemove",i),i(e),null!=r.style.opacity&&(r.style.opacity=1),r}function n(t){t.parentNode&&t.parentNode.removeChild(t)}function i(t){t.parentNode&&(null==t.style.opacity&&n(t),t.style.opacity=0,setTimeout(function(){n(t)},600))}function r(n,r,s){function o(){t.off(s,"mouseout",o),a&&(i(a),a=null)}var a=e(n,r),l=setInterval(function(){if(a)for(var t=s;;t=t.parentNode){if(t&&11==t.nodeType&&(t=t.host),t==document.body)return;if(!t){o();break}}if(!a)return clearInterval(l)},400);t.on(s,"mouseout",o)}function s(t,e,n){this.marked=[],this.options=e,this.timeout=null,this.hasGutter=n,this.onMouseOver=function(e){v(t,e)},this.waitingFor=0}function o(t,e){return e instanceof Function?{getAnnotations:e}:(e&&e!==!0||(e={}),e)}function a(t){var e=t.state.lint;e.hasGutter&&t.clearGutter(_);for(var n=0;n<e.marked.length;++n)e.marked[n].clear();e.marked.length=0}function l(e,n,i,s){var o=document.createElement("div"),a=o;return o.className="CodeMirror-lint-marker-"+n,i&&(a=o.appendChild(document.createElement("div")),a.className="CodeMirror-lint-marker-multiple"),0!=s&&t.on(a,"mouseover",function(t){r(t,e,a)}),o}function c(t,e){return"error"==t?t:e}function u(t){for(var e=[],n=0;n<t.length;++n){var i=t[n],r=i.from.line;(e[r]||(e[r]=[])).push(i)}return e}function d(t){var e=t.severity;e||(e="error");var n=document.createElement("div");return n.className="CodeMirror-lint-message-"+e,n.appendChild(document.createTextNode(t.message)),n}function h(e,n,i){function r(){o=-1,e.off("change",r)}var s=e.state.lint,o=++s.waitingFor;e.on("change",r),n(e.getValue(),function(n,i){e.off("change",r),s.waitingFor==o&&(i&&n instanceof t&&(n=i),p(e,n))},i,e)}function f(e){var n=e.state.lint,i=n.options,r=i.options||i,s=i.getAnnotations||e.getHelper(t.Pos(0,0),"lint");s&&(i.async||s.async?h(e,s,r):p(e,s(e.getValue(),r,e)))}function p(t,e){a(t);for(var n=t.state.lint,i=n.options,r=u(e),s=0;s<r.length;++s){var o=r[s];if(o){for(var h=null,f=n.hasGutter&&document.createDocumentFragment(),p=0;p<o.length;++p){var g=o[p],m=g.severity;m||(m="error"),h=c(h,m),i.formatAnnotation&&(g=i.formatAnnotation(g)),n.hasGutter&&f.appendChild(d(g)),g.to&&n.marked.push(t.markText(g.from,g.to,{className:"CodeMirror-lint-mark-"+m,__annotation:g}))}n.hasGutter&&t.setGutterMarker(s,_,l(f,h,o.length>1,n.options.tooltips))}}i.onUpdateLinting&&i.onUpdateLinting(e,r,t)}function g(t){var e=t.state.lint;e&&(clearTimeout(e.timeout),e.timeout=setTimeout(function(){f(t)},e.options.delay||500))}function m(t,e){for(var n=e.target||e.srcElement,i=document.createDocumentFragment(),s=0;s<t.length;s++){var o=t[s];i.appendChild(d(o))}r(e,i,n)}function v(t,e){var n=e.target||e.srcElement;if(/\bCodeMirror-lint-mark-/.test(n.className)){for(var i=n.getBoundingClientRect(),r=(i.left+i.right)/2,s=(i.top+i.bottom)/2,o=t.findMarksAt(t.coordsChar({left:r,top:s},"client")),a=[],l=0;l<o.length;++l){var c=o[l].__annotation;c&&a.push(c)}a.length&&m(a,e)}}var _="CodeMirror-lint-markers";t.defineOption("lint",!1,function(e,n,i){if(i&&i!=t.Init&&(a(e),e.state.lint.options.lintOnChange!==!1&&e.off("change",g),t.off(e.getWrapperElement(),"mouseover",e.state.lint.onMouseOver),clearTimeout(e.state.lint.timeout),delete e.state.lint),n){for(var r=e.getOption("gutters"),l=!1,c=0;c<r.length;++c)r[c]==_&&(l=!0);var u=e.state.lint=new s(e,o(e,n),l);u.options.lintOnChange!==!1&&e.on("change",g),0!=u.options.tooltips&&t.on(e.getWrapperElement(),"mouseover",u.onMouseOver),f(e)}}),t.defineExtension("performLint",function(){this.state.lint&&f(this)})});