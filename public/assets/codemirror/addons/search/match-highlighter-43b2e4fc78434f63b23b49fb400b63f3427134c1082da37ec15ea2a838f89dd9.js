!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror"),require("./matchesonscrollbar")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./matchesonscrollbar"],t):t(CodeMirror)}(function(t){"use strict";function e(t){this.options={};for(var e in c)this.options[e]=(t&&t.hasOwnProperty(e)?t:c)[e];this.overlay=this.timeout=null,this.matchesonscroll=null}function n(t){var e=t.state.matchHighlighter;clearTimeout(e.timeout),e.timeout=setTimeout(function(){s(t)},e.options.delay)}function i(t,e,n,i){var r=t.state.matchHighlighter;if(t.addOverlay(r.overlay=l(e,n,i)),r.options.annotateScrollbar&&t.showMatchesOnScrollbar){var s=n?new RegExp("\\b"+e+"\\b"):e;r.matchesonscroll=t.showMatchesOnScrollbar(s,!0,{className:"CodeMirror-selection-highlight-scrollbar"})}}function r(t){var e=t.state.matchHighlighter;e.overlay&&(t.removeOverlay(e.overlay),e.overlay=null,e.matchesonscroll&&(e.matchesonscroll.clear(),e.matchesonscroll=null))}function s(t){t.operation(function(){var e=t.state.matchHighlighter;if(r(t),!t.somethingSelected()&&e.options.showToken){for(var n=e.options.showToken===!0?/[\w$]/:e.options.showToken,s=t.getCursor(),a=t.getLine(s.line),l=s.ch,c=l;l&&n.test(a.charAt(l-1));)--l;for(;c<a.length&&n.test(a.charAt(c));)++c;return void(l<c&&i(t,a.slice(l,c),n,e.options.style))}var u=t.getCursor("from"),d=t.getCursor("to");if(u.line==d.line&&(!e.options.wordsOnly||o(t,u,d))){var h=t.getRange(u,d);e.options.trim&&(h=h.replace(/^\s+|\s+$/g,"")),h.length>=e.options.minChars&&i(t,h,!1,e.options.style)}})}function o(t,e,n){var i=t.getRange(e,n);if(null!==i.match(/^\w+$/)){if(e.ch>0){var r={line:e.line,ch:e.ch-1},s=t.getRange(r,e);if(null===s.match(/\W/))return!1}if(n.ch<t.getLine(e.line).length){var r={line:n.line,ch:n.ch+1},s=t.getRange(n,r);if(null===s.match(/\W/))return!1}return!0}return!1}function a(t,e){return!(t.start&&e.test(t.string.charAt(t.start-1))||t.pos!=t.string.length&&e.test(t.string.charAt(t.pos)))}function l(t,e,n){return{token:function(i){return!i.match(t)||e&&!a(i,e)?(i.next(),void(i.skipTo(t.charAt(0))||i.skipToEnd())):n}}}var c={style:"matchhighlight",minChars:2,delay:100,wordsOnly:!1,annotateScrollbar:!1,showToken:!1,trim:!0};t.defineOption("highlightSelectionMatches",!1,function(i,o,a){a&&a!=t.Init&&(r(i),clearTimeout(i.state.matchHighlighter.timeout),i.state.matchHighlighter=null,i.off("cursorActivity",n)),o&&(i.state.matchHighlighter=new e(o),s(i),i.on("cursorActivity",n))})});