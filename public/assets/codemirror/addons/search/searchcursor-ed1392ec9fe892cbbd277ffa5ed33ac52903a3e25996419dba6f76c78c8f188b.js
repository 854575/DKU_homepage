!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";function e(t,e,r,s){if(this.atOccurrence=!1,this.doc=t,null==s&&"string"==typeof e&&(s=!1),r=r?t.clipPos(r):i(0,0),this.pos={from:r,to:r},"string"!=typeof e)e.global||(e=new RegExp(e.source,e.ignoreCase?"ig":"g")),this.matches=function(n,r){if(n){e.lastIndex=0;for(var s,o,a=t.getLine(r.line).slice(0,r.ch),l=0;;){e.lastIndex=l;var c=e.exec(a);if(!c)break;if(s=c,o=s.index,l=s.index+(s[0].length||1),l==a.length)break}var u=s&&s[0].length||0;u||(0==o&&0==a.length?s=void 0:o!=t.getLine(r.line).length&&u++)}else{e.lastIndex=r.ch;var a=t.getLine(r.line),s=e.exec(a),u=s&&s[0].length||0,o=s&&s.index;o+u==a.length||u||(u=1)}if(s&&u)return{from:i(r.line,o),to:i(r.line,o+u),match:s}};else{var o=e;s&&(e=e.toLowerCase());var a=s?function(t){return t.toLowerCase()}:function(t){return t},l=e.split("\n");if(1==l.length)e.length?this.matches=function(r,s){if(r){var l=t.getLine(s.line).slice(0,s.ch),c=a(l),u=c.lastIndexOf(e);if(u>-1)return u=n(l,c,u),{from:i(s.line,u),to:i(s.line,u+o.length)}}else{var l=t.getLine(s.line).slice(s.ch),c=a(l),u=c.indexOf(e);if(u>-1)return u=n(l,c,u)+s.ch,{from:i(s.line,u),to:i(s.line,u+o.length)}}}:this.matches=function(){};else{var c=o.split("\n");this.matches=function(e,n){var r=l.length-1;if(e){if(n.line-(l.length-1)<t.firstLine())return;if(a(t.getLine(n.line).slice(0,c[r].length))!=l[l.length-1])return;for(var s=i(n.line,c[r].length),o=n.line-1,u=r-1;u>=1;--u,--o)if(l[u]!=a(t.getLine(o)))return;var d=t.getLine(o),h=d.length-c[0].length;if(a(d.slice(h))!=l[0])return;return{from:i(o,h),to:s}}if(!(n.line+(l.length-1)>t.lastLine())){var d=t.getLine(n.line),h=d.length-c[0].length;if(a(d.slice(h))==l[0]){for(var f=i(n.line,h),o=n.line+1,u=1;u<r;++u,++o)if(l[u]!=a(t.getLine(o)))return;if(a(t.getLine(o).slice(0,c[r].length))==l[r])return{from:f,to:i(o,c[r].length)}}}}}}}function n(t,e,n){if(t.length==e.length)return n;for(var i=Math.min(n,t.length);;){var r=t.slice(0,i).toLowerCase().length;if(r<n)++i;else{if(!(r>n))return i;--i}}}var i=t.Pos;e.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(t){function e(t){var e=i(t,0);return n.pos={from:e,to:e},n.atOccurrence=!1,!1}for(var n=this,r=this.doc.clipPos(t?this.pos.from:this.pos.to);;){if(this.pos=this.matches(t,r))return this.atOccurrence=!0,this.pos.match||!0;if(t){if(!r.line)return e(0);r=i(r.line-1,this.doc.getLine(r.line-1).length)}else{var s=this.doc.lineCount();if(r.line==s-1)return e(s);r=i(r.line+1,0)}}},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(e,n){if(this.atOccurrence){var r=t.splitLines(e);this.doc.replaceRange(r,this.pos.from,this.pos.to,n),this.pos.to=i(this.pos.from.line+r.length-1,r[r.length-1].length+(1==r.length?this.pos.from.ch:0))}}},t.defineExtension("getSearchCursor",function(t,n,i){return new e(this.doc,t,n,i)}),t.defineDocExtension("getSearchCursor",function(t,n,i){return new e(this,t,n,i)}),t.defineExtension("selectMatches",function(e,n){for(var i=[],r=this.getSearchCursor(e,this.getCursor("from"),n);r.findNext()&&!(t.cmpPos(r.to(),this.getCursor("to"))>0);)i.push({anchor:r.from(),head:r.to()});i.length&&this.setSelections(i,0)})});