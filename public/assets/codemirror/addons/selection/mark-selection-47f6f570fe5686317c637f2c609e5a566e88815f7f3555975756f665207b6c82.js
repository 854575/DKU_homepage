!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";function e(t){t.operation(function(){o(t)})}function n(t){t.state.markedSelection.length&&t.operation(function(){r(t)})}function i(t,e,n,i){if(0!=c(e,n))for(var r=t.state.markedSelection,s=t.state.markedSelectionStyle,o=e.line;;){var u=o==e.line?e:l(o,0),d=o+a,h=d>=n.line,f=h?n:l(d,0),p=t.markText(u,f,{className:s});if(null==i?r.push(p):r.splice(i++,0,p),h)break;o=d}}function r(t){for(var e=t.state.markedSelection,n=0;n<e.length;++n)e[n].clear();e.length=0}function s(t){r(t);for(var e=t.listSelections(),n=0;n<e.length;n++)i(t,e[n].from(),e[n].to())}function o(t){if(!t.somethingSelected())return r(t);if(t.listSelections().length>1)return s(t);var e=t.getCursor("start"),n=t.getCursor("end"),o=t.state.markedSelection;if(!o.length)return i(t,e,n);var l=o[0].find(),u=o[o.length-1].find();if(!l||!u||n.line-e.line<a||c(e,u.to)>=0||c(n,l.from)<=0)return s(t);for(;c(e,l.from)>0;)o.shift().clear(),l=o[0].find();for(c(e,l.from)<0&&(l.to.line-e.line<a?(o.shift().clear(),i(t,e,l.to,0)):i(t,e,l.from,0));c(n,u.to)<0;)o.pop().clear(),u=o[o.length-1].find();c(n,u.to)>0&&(n.line-u.from.line<a?(o.pop().clear(),i(t,u.from,n)):i(t,u.to,n))}t.defineOption("styleSelectedText",!1,function(i,o,a){var l=a&&a!=t.Init;o&&!l?(i.state.markedSelection=[],i.state.markedSelectionStyle="string"==typeof o?o:"CodeMirror-selectedtext",s(i),i.on("cursorActivity",e),i.on("change",n)):!o&&l&&(i.off("cursorActivity",e),i.off("change",n),r(i),i.state.markedSelection=i.state.markedSelectionStyle=null)});var a=8,l=t.Pos,c=t.cmpPos});