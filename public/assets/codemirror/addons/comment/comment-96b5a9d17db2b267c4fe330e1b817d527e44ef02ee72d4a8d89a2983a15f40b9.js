!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";function e(t){var e=t.search(s);return e==-1?0:e}function n(t,e,n){return/\bstring\b/.test(t.getTokenTypeAt(r(e.line,0)))&&!/^[\'\"`]/.test(n)}var i={},s=/[^\s\u00a0]/,r=t.Pos;t.commands.toggleComment=function(t){t.toggleComment()},t.defineExtension("toggleComment",function(t){t||(t=i);for(var e=this,n=1/0,s=this.listSelections(),a=null,o=s.length-1;o>=0;o--){var l=s[o].from(),c=s[o].to();l.line>=n||(c.line>=n&&(c=r(n,0)),n=l.line,null==a?e.uncomment(l,c,t)?a="un":(e.lineComment(l,c,t),a="line"):"un"==a?e.uncomment(l,c,t):e.lineComment(l,c,t))}}),t.defineExtension("lineComment",function(t,a,o){o||(o=i);var l=this,c=l.getModeAt(t),d=l.getLine(t.line);if(null!=d&&!n(l,t,d)){var u=o.lineComment||c.lineComment;if(!u)return void((o.blockCommentStart||c.blockCommentStart)&&(o.fullLines=!0,l.blockComment(t,a,o)));var h=Math.min(0!=a.ch||a.line==t.line?a.line+1:a.line,l.lastLine()+1),f=null==o.padding?" ":o.padding,p=o.commentBlankLines||t.line==a.line;l.operation(function(){if(o.indent){for(var n=null,i=t.line;i<h;++i){var a=l.getLine(i),c=a.slice(0,e(a));(null==n||n.length>c.length)&&(n=c)}for(var i=t.line;i<h;++i){var a=l.getLine(i),d=n.length;(p||s.test(a))&&(a.slice(0,d)!=n&&(d=e(a)),l.replaceRange(n+u+f,r(i,0),r(i,d)))}}else for(var i=t.line;i<h;++i)(p||s.test(l.getLine(i)))&&l.replaceRange(u+f,r(i,0))})}}),t.defineExtension("blockComment",function(t,e,n){n||(n=i);var a=this,o=a.getModeAt(t),l=n.blockCommentStart||o.blockCommentStart,c=n.blockCommentEnd||o.blockCommentEnd;if(!l||!c)return void((n.lineComment||o.lineComment)&&0!=n.fullLines&&a.lineComment(t,e,n));var d=Math.min(e.line,a.lastLine());d!=t.line&&0==e.ch&&s.test(a.getLine(d))&&--d;var u=null==n.padding?" ":n.padding;t.line>d||a.operation(function(){if(0!=n.fullLines){var i=s.test(a.getLine(d));a.replaceRange(u+c,r(d)),a.replaceRange(l+u,r(t.line,0));var h=n.blockCommentLead||o.blockCommentLead;if(null!=h)for(var f=t.line+1;f<=d;++f)(f!=d||i)&&a.replaceRange(h+u,r(f,0))}else a.replaceRange(c,e),a.replaceRange(l,t)})}),t.defineExtension("uncomment",function(t,e,n){n||(n=i);var a,o=this,l=o.getModeAt(t),c=Math.min(0!=e.ch||e.line==t.line?e.line:e.line-1,o.lastLine()),d=Math.min(t.line,c),u=n.lineComment||l.lineComment,h=[],f=null==n.padding?" ":n.padding;t:if(u){for(var p=d;p<=c;++p){var g=o.getLine(p),m=g.indexOf(u);if(m>-1&&!/comment/.test(o.getTokenTypeAt(r(p,m+1)))&&(m=-1),m==-1&&(p!=c||p==d)&&s.test(g))break t;if(m>-1&&s.test(g.slice(0,m)))break t;h.push(g)}if(o.operation(function(){for(var t=d;t<=c;++t){var e=h[t-d],n=e.indexOf(u),i=n+u.length;n<0||(e.slice(i,i+f.length)==f&&(i+=f.length),a=!0,o.replaceRange("",r(t,n),r(t,i)))}}),a)return!0}var v=n.blockCommentStart||l.blockCommentStart,_=n.blockCommentEnd||l.blockCommentEnd;if(!v||!_)return!1;var y=n.blockCommentLead||l.blockCommentLead,b=o.getLine(d),x=c==d?b:o.getLine(c),w=b.indexOf(v),C=x.lastIndexOf(_);if(C==-1&&d!=c&&(x=o.getLine(--c),C=x.lastIndexOf(_)),w==-1||C==-1||!/comment/.test(o.getTokenTypeAt(r(d,w+1)))||!/comment/.test(o.getTokenTypeAt(r(c,C+1))))return!1;var k=b.lastIndexOf(v,t.ch),S=k==-1?-1:b.slice(0,t.ch).indexOf(_,k+v.length);if(k!=-1&&S!=-1&&S+_.length!=t.ch)return!1;S=x.indexOf(_,e.ch);var T=x.slice(e.ch).lastIndexOf(v,S-e.ch);return k=S==-1||T==-1?-1:e.ch+T,(S==-1||k==-1||k==e.ch)&&(o.operation(function(){o.replaceRange("",r(c,C-(f&&x.slice(C-f.length,C)==f?f.length:0)),r(c,C+_.length));var t=w+v.length;if(f&&b.slice(t,t+f.length)==f&&(t+=f.length),o.replaceRange("",r(d,w),r(d,t)),y)for(var e=d+1;e<=c;++e){var n=o.getLine(e),i=n.indexOf(y);if(i!=-1&&!s.test(n.slice(0,i))){var a=i+y.length;f&&n.slice(a,a+f.length)==f&&(a+=f.length),o.replaceRange("",r(e,i),r(e,a))}}}),!0)})});