!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";function e(t,e){return t.line-e.line||t.ch-e.ch}function n(t,e,n,i){this.line=e,this.ch=n,this.cm=t,this.text=t.getLine(e),this.min=i?i.from:t.firstLine(),this.max=i?i.to-1:t.lastLine()}function i(t,e){var n=t.cm.getTokenTypeAt(h(t.line,e));return n&&/\btag\b/.test(n)}function s(t){if(!(t.line>=t.max))return t.ch=0,t.text=t.cm.getLine(++t.line),!0}function r(t){if(!(t.line<=t.min))return t.text=t.cm.getLine(--t.line),t.ch=t.text.length,!0}function a(t){for(;;){var e=t.text.indexOf(">",t.ch);if(e==-1){if(s(t))continue;return}{if(i(t,e+1)){var n=t.text.lastIndexOf("/",e),r=n>-1&&!/\S/.test(t.text.slice(n+1,e));return t.ch=e+1,r?"selfClose":"regular"}t.ch=e+1}}}function o(t){for(;;){var e=t.ch?t.text.lastIndexOf("<",t.ch-1):-1;if(e==-1){if(r(t))continue;return}if(i(t,e+1)){g.lastIndex=e,t.ch=e;var n=g.exec(t.text);if(n&&n.index==e)return n}else t.ch=e}}function l(t){for(;;){g.lastIndex=t.ch;var e=g.exec(t.text);if(!e){if(s(t))continue;return}{if(i(t,e.index+1))return t.ch=e.index+e[0].length,e;t.ch=e.index+1}}}function c(t){for(;;){var e=t.ch?t.text.lastIndexOf(">",t.ch-1):-1;if(e==-1){if(r(t))continue;return}{if(i(t,e+1)){var n=t.text.lastIndexOf("/",e),s=n>-1&&!/\S/.test(t.text.slice(n+1,e));return t.ch=e+1,s?"selfClose":"regular"}t.ch=e}}}function d(t,e){for(var n=[];;){var i,s=l(t),r=t.line,o=t.ch-(s?s[0].length:0);if(!s||!(i=a(t)))return;if("selfClose"!=i)if(s[1]){for(var c=n.length-1;c>=0;--c)if(n[c]==s[2]){n.length=c;break}if(c<0&&(!e||e==s[2]))return{tag:s[2],from:h(r,o),to:h(t.line,t.ch)}}else n.push(s[2])}}function u(t,e){for(var n=[];;){var i=c(t);if(!i)return;if("selfClose"!=i){var s=t.line,r=t.ch,a=o(t);if(!a)return;if(a[1])n.push(a[2]);else{for(var l=n.length-1;l>=0;--l)if(n[l]==a[2]){n.length=l;break}if(l<0&&(!e||e==a[2]))return{tag:a[2],from:h(t.line,t.ch),to:h(s,r)}}}else o(t)}}var h=t.Pos,f="A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",p=f+"-:.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040",g=new RegExp("<(/?)(["+f+"]["+p+"]*)","g");t.registerHelper("fold","xml",function(t,e){for(var i=new n(t,e.line,0);;){var s,r=l(i);if(!r||i.line!=e.line||!(s=a(i)))return;if(!r[1]&&"selfClose"!=s){var o=h(i.line,i.ch),c=d(i,r[2]);return c&&{from:o,to:c.from}}}}),t.findMatchingTag=function(t,i,s){var r=new n(t,i.line,i.ch,s);if(r.text.indexOf(">")!=-1||r.text.indexOf("<")!=-1){var l=a(r),c=l&&h(r.line,r.ch),f=l&&o(r);if(l&&f&&!(e(r,i)>0)){var p={from:h(r.line,r.ch),to:c,tag:f[2]};return"selfClose"==l?{open:p,close:null,at:"open"}:f[1]?{open:u(r,f[2]),close:p,at:"close"}:(r=new n(t,c.line,c.ch,s),{open:p,close:d(r,f[2]),at:"open"})}}},t.findEnclosingTag=function(t,e,i){for(var s=new n(t,e.line,e.ch,i);;){var r=u(s);if(!r)break;var a=new n(t,e.line,e.ch,i),o=d(a,r.tag);if(o)return{open:r,close:o}}},t.scanForClosingTag=function(t,e,i,s){var r=new n(t,e.line,e.ch,s?{from:0,to:s}:null);return d(r,i)}});