!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";function e(e,s,r,a){function o(t){var n=l(e,s);if(!n||n.to.line-n.from.line<c)return null;for(var i=e.findMarksAt(n.from),r=0;r<i.length;++r)if(i[r].__isFold&&"fold"!==a){if(!t)return null;n.cleared=!0,i[r].clear()}return n}if(r&&r.call){var l=r;r=null}else var l=i(e,r,"rangeFinder");"number"==typeof s&&(s=t.Pos(s,0));var c=i(e,r,"minFoldSize"),d=o(!0);if(i(e,r,"scanUp"))for(;!d&&s.line>e.firstLine();)s=t.Pos(s.line-1,0),d=o(!1);if(d&&!d.cleared&&"unfold"!==a){var u=n(e,r);t.on(u,"mousedown",function(e){h.clear(),t.e_preventDefault(e)});var h=e.markText(d.from,d.to,{replacedWith:u,clearOnEnter:i(e,r,"clearOnEnter"),__isFold:!0});h.on("clear",function(n,i){t.signal(e,"unfold",e,n,i)}),t.signal(e,"fold",e,d.from,d.to)}}function n(t,e){var n=i(t,e,"widget");if("string"==typeof n){var s=document.createTextNode(n);n=document.createElement("span"),n.appendChild(s),n.className="CodeMirror-foldmarker"}return n}function i(t,e,n){if(e&&void 0!==e[n])return e[n];var i=t.options.foldOptions;return i&&void 0!==i[n]?i[n]:s[n]}t.newFoldFunction=function(t,n){return function(i,s){e(i,s,{rangeFinder:t,widget:n})}},t.defineExtension("foldCode",function(t,n,i){e(this,t,n,i)}),t.defineExtension("isFolded",function(t){for(var e=this.findMarksAt(t),n=0;n<e.length;++n)if(e[n].__isFold)return!0}),t.commands.toggleFold=function(t){t.foldCode(t.getCursor())},t.commands.fold=function(t){t.foldCode(t.getCursor(),null,"fold")},t.commands.unfold=function(t){t.foldCode(t.getCursor(),null,"unfold")},t.commands.foldAll=function(e){e.operation(function(){for(var n=e.firstLine(),i=e.lastLine();n<=i;n++)e.foldCode(t.Pos(n,0),null,"fold")})},t.commands.unfoldAll=function(e){e.operation(function(){for(var n=e.firstLine(),i=e.lastLine();n<=i;n++)e.foldCode(t.Pos(n,0),null,"unfold")})},t.registerHelper("fold","combine",function(){var t=Array.prototype.slice.call(arguments,0);return function(e,n){for(var i=0;i<t.length;++i){var s=t[i](e,n);if(s)return s}}}),t.registerHelper("fold","auto",function(t,e){for(var n=t.getHelpers(e,"fold"),i=0;i<n.length;i++){var s=n[i](t,e);if(s)return s}});var s={rangeFinder:t.fold.auto,widget:"\u2194",minFoldSize:0,scanUp:!1,clearOnEnter:!0};t.defineOption("foldOptions",null),t.defineExtension("foldOption",function(t,e){return i(this,t,e)})});