!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror"),require("./foldcode")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./foldcode"],t):t(CodeMirror)}(function(t){"use strict";function e(t){this.options=t,this.from=this.to=0}function n(t){return t===!0&&(t={}),null==t.gutter&&(t.gutter="CodeMirror-foldgutter"),null==t.indicatorOpen&&(t.indicatorOpen="CodeMirror-foldgutter-open"),null==t.indicatorFolded&&(t.indicatorFolded="CodeMirror-foldgutter-folded"),t}function i(t,e){for(var n=t.findMarks(u(e,0),u(e+1,0)),i=0;i<n.length;++i)if(n[i].__isFold&&n[i].find().from.line==e)return n[i]}function s(t){if("string"==typeof t){var e=document.createElement("div");return e.className=t+" CodeMirror-guttermarker-subtle",e}return t.cloneNode(!0)}function r(t,e,n){var r=t.state.foldGutter.options,a=e,o=t.foldOption(r,"minFoldSize"),l=t.foldOption(r,"rangeFinder");t.eachLine(e,n,function(e){var n=null;if(i(t,a))n=s(r.indicatorFolded);else{var c=u(a,0),d=l&&l(t,c);d&&d.to.line-d.from.line>=o&&(n=s(r.indicatorOpen))}t.setGutterMarker(e,r.gutter,n),++a})}function a(t){var e=t.getViewport(),n=t.state.foldGutter;n&&(t.operation(function(){r(t,e.from,e.to)}),n.from=e.from,n.to=e.to)}function o(t,e,n){var s=t.state.foldGutter;if(s){var r=s.options;if(n==r.gutter){var a=i(t,e);a?a.clear():t.foldCode(u(e,0),r.rangeFinder)}}}function l(t){var e=t.state.foldGutter;if(e){var n=e.options;e.from=e.to=0,clearTimeout(e.changeUpdate),e.changeUpdate=setTimeout(function(){a(t)},n.foldOnChangeTimeSpan||600)}}function c(t){var e=t.state.foldGutter;if(e){var n=e.options;clearTimeout(e.changeUpdate),e.changeUpdate=setTimeout(function(){var n=t.getViewport();e.from==e.to||n.from-e.to>20||e.from-n.to>20?a(t):t.operation(function(){n.from<e.from&&(r(t,n.from,e.from),e.from=n.from),n.to>e.to&&(r(t,e.to,n.to),e.to=n.to)})},n.updateViewportTimeSpan||400)}}function d(t,e){var n=t.state.foldGutter;if(n){var i=e.line;i>=n.from&&i<n.to&&r(t,i,i+1)}}t.defineOption("foldGutter",!1,function(i,s,r){r&&r!=t.Init&&(i.clearGutter(i.state.foldGutter.options.gutter),i.state.foldGutter=null,i.off("gutterClick",o),i.off("change",l),i.off("viewportChange",c),i.off("fold",d),i.off("unfold",d),i.off("swapDoc",l)),s&&(i.state.foldGutter=new e(n(s)),a(i),i.on("gutterClick",o),i.on("change",l),i.on("viewportChange",c),i.on("fold",d),i.on("unfold",d),i.on("swapDoc",l))});var u=t.Pos});