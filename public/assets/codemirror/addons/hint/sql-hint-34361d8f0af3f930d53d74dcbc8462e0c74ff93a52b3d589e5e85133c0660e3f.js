!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror"),require("../../mode/sql/sql")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../../mode/sql/sql"],t):t(CodeMirror)}(function(t){"use strict";function e(t){return"[object Array]"==Object.prototype.toString.call(t)}function n(e){var n=e.doc.modeOption;return"sql"===n&&(n="text/x-sql"),t.resolveMode(n).keywords}function i(t){return"string"==typeof t?t:t.text}function s(t,n){return e(n)&&(n={columns:n}),n.text||(n.text=t),n}function r(t){var n={};if(e(t))for(var r=t.length-1;r>=0;r--){var o=t[r];n[i(o).toUpperCase()]=s(i(o),o)}else if(t)for(var a in t)n[a.toUpperCase()]=s(a,t[a]);return n}function o(t){return g[t.toUpperCase()]}function a(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function l(t,e){var n=t.length,s=i(e).substr(0,n);return t.toUpperCase()===s.toUpperCase()}function c(t,n,i,s){if(e(i))for(var r=0;r<i.length;r++)l(n,i[r])&&t.push(s(i[r]));else for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];a=a&&a!==!0?a.displayText?{text:a.text,displayText:a.displayText}:a.text:o,l(n,a)&&t.push(s(a))}}function u(t){return"."==t.charAt(0)&&(t=t.substr(1)),t.replace(/`/g,"")}function d(t){for(var e=i(t).split("."),n=0;n<e.length;n++)e[n]="`"+e[n]+"`";var s=e.join(".");return"string"==typeof t?s:(t=a(t),t.text=s,t)}function h(t,e,n,i){for(var s=!1,r=[],l=e.start,h=!0;h;)h="."==e.string.charAt(0),s=s||"`"==e.string.charAt(0),l=e.start,r.unshift(u(e.string)),e=i.getTokenAt(y(t.line,e.start)),"."==e.string&&(h=!0,e=i.getTokenAt(y(t.line,e.start)));var f=r.join(".");c(n,f,g,function(t){return s?d(t):t}),c(n,f,m,function(t){return s?d(t):t}),f=r.pop();var v=r.join("."),_=!1,b=v;if(!o(v)){var x=v;v=p(v,i),v!==x&&(_=!0)}var w=o(v);return w&&w.columns&&(w=w.columns),w&&c(n,f,w,function(t){var e=v;return 1==_&&(e=b),"string"==typeof t?t=e+"."+t:(t=a(t),t.text=e+"."+t.text),s?d(t):t}),l}function f(t,e){if(t)for(var n=/[,;]/g,i=t.split(" "),s=0;s<i.length;s++)e(i[s]?i[s].replace(n,""):"")}function p(t,e){for(var n=e.doc,i=n.getValue(),s=t.toUpperCase(),r="",a="",l=[],c={start:y(0,0),end:y(e.lastLine(),e.getLineHandle(e.lastLine()).length)},u=i.indexOf(_.QUERY_DIV);u!=-1;)l.push(n.posFromIndex(u)),u=i.indexOf(_.QUERY_DIV,u+1);l.unshift(y(0,0)),l.push(y(e.lastLine(),e.getLineHandle(e.lastLine()).text.length));for(var d=null,h=e.getCursor(),p=0;p<l.length;p++){if((null==d||b(h,d)>0)&&b(h,l[p])<=0){c={start:d,end:l[p]};break}d=l[p]}for(var g=n.getRange(c.start,c.end,!1),p=0;p<g.length;p++){var m=g[p];if(f(m,function(t){var e=t.toUpperCase();e===s&&o(r)&&(a=r),e!==_.ALIAS_KEYWORD&&(r=t)}),a)break}return a}var g,m,v,_={QUERY_DIV:";",ALIAS_KEYWORD:"AS"},y=t.Pos,b=t.cmpPos;t.registerHelper("hint","sql",function(t,e){g=r(e&&e.tables);var i=e&&e.defaultTable,s=e&&e.disableKeywords;m=i&&o(i),v=n(t),i&&!m&&(m=p(i,t)),m=m||[],m.columns&&(m=m.columns);var a,l,u,d=t.getCursor(),f=[],_=t.getTokenAt(d);return _.end>d.ch&&(_.end=d.ch,_.string=_.string.slice(0,d.ch-_.start)),_.string.match(/^[.`\w@]\w*$/)?(u=_.string,a=_.start,l=_.end):(a=l=d.ch,u=""),"."==u.charAt(0)||"`"==u.charAt(0)?a=h(d,_,f,t):(c(f,u,g,function(t){return t}),c(f,u,m,function(t){return t}),s||c(f,u,v,function(t){return t.toUpperCase()})),{list:f,from:y(d.line,a),to:y(d.line,l)}})});