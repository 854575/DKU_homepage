!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";function e(e,i){var s=i&&i.schemaInfo,r=i&&i.quoteChar||'"';if(s){var o=e.getCursor(),a=e.getTokenAt(o);a.end>o.ch&&(a.end=o.ch,a.string=a.string.slice(0,o.ch-a.start));var l=t.innerMode(e.getMode(),a.state);if("xml"==l.mode.name){var c,u,d=[],h=!1,f=/\btag\b/.test(a.type)&&!/>$/.test(a.string),p=f&&/^\w/.test(a.string);if(p){var g=e.getLine(o.line).slice(Math.max(0,a.start-2),a.start),m=/<\/$/.test(g)?"close":/<$/.test(g)?"open":null;m&&(u=a.start-("close"==m?2:1))}else f&&"<"==a.string?m="open":f&&"</"==a.string&&(m="close");if(!f&&!l.state.tagName||m){p&&(c=a.string),h=m;var v=l.state.context,_=v&&s[v.tagName],y=v?_&&_.children:s["!top"];if(y&&"close"!=m)for(var b=0;b<y.length;++b)c&&0!=y[b].lastIndexOf(c,0)||d.push("<"+y[b]);else if("close"!=m)for(var x in s)!s.hasOwnProperty(x)||"!top"==x||"!attrs"==x||c&&0!=x.lastIndexOf(c,0)||d.push("<"+x);v&&(!c||"close"==m&&0==v.tagName.lastIndexOf(c,0))&&d.push("</"+v.tagName+">")}else{var _=s[l.state.tagName],w=_&&_.attrs,C=s["!attrs"];if(!w&&!C)return;if(w){if(C){var k={};for(var S in C)C.hasOwnProperty(S)&&(k[S]=C[S]);for(var S in w)w.hasOwnProperty(S)&&(k[S]=w[S]);w=k}}else w=C;if("string"==a.type||"="==a.string){var T,g=e.getRange(n(o.line,Math.max(0,o.ch-60)),n(o.line,"string"==a.type?a.start:a.end)),A=g.match(/([^\s\u00a0=<>\"\']+)=$/);if(!A||!w.hasOwnProperty(A[1])||!(T=w[A[1]]))return;if("function"==typeof T&&(T=T.call(this,e)),"string"==a.type){c=a.string;var E=0;/['"]/.test(a.string.charAt(0))&&(r=a.string.charAt(0),c=a.string.slice(1),E++);var L=a.string.length;/['"]/.test(a.string.charAt(L-1))&&(r=a.string.charAt(L-1),c=a.string.substr(E,L-2)),h=!0}for(var b=0;b<T.length;++b)c&&0!=T[b].lastIndexOf(c,0)||d.push(r+T[b]+r)}else{"attribute"==a.type&&(c=a.string,h=!0);for(var j in w)!w.hasOwnProperty(j)||c&&0!=j.lastIndexOf(c,0)||d.push(j)}}return{list:d,from:h?n(o.line,null==u?a.start:u):o,to:h?n(o.line,a.end):o}}}}var n=t.Pos;t.registerHelper("hint","xml",e)});