!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";function e(t,e,n){for(var i=n.paragraphStart||t.getHelper(e,"paragraphStart"),r=e.line,o=t.firstLine();r>o;--r){var s=t.getLine(r);if(i&&i.test(s))break;if(!/\S/.test(s)){++r;break}}for(var a=n.paragraphEnd||t.getHelper(e,"paragraphEnd"),l=e.line+1,c=t.lastLine();l<=c;++l){var s=t.getLine(l);if(a&&a.test(s)){++l;break}if(!/\S/.test(s))break}return{from:r,to:l}}function n(t,e,n,i){for(var r=e;r<t.length&&" "==t.charAt(r);)r++;for(;r>0&&!n.test(t.slice(r-1,r+1));--r);for(var o=!0;;o=!1){var s=r;if(i)for(;" "==t.charAt(s-1);)--s;if(0!=s||!o)return{from:s,to:r};r=e}}function i(e,i,o,s){i=e.clipPos(i),o=e.clipPos(o);var a=s.column||80,l=s.wrapOn||/\s\S|-[^\.\d]/,c=s.killTrailingSpace!==!1,u=[],d="",h=i.line,f=e.getRange(i,o,!1);if(!f.length)return null;for(var p=f[0].match(/^[ \t]*/)[0],g=0;g<f.length;++g){var m=f[g],v=d.length,_=0;d&&m&&!l.test(d.charAt(d.length-1)+m.charAt(0))&&(d+=" ",_=1);var y="";if(g&&(y=m.match(/^\s*/)[0],m=m.slice(y.length)),d+=m,g){var b=d.length>a&&p==y&&n(d,a,l,c);b&&b.from==v&&b.to==v+_?(d=p+m,++h):u.push({text:[_?" ":""],from:r(h,v),to:r(h+1,y.length)})}for(;d.length>a;){var x=n(d,a,l,c);u.push({text:["",p],from:r(h,x.from),to:r(h,x.to)}),d=p+d.slice(x.to),++h}}return u.length&&e.operation(function(){for(var n=0;n<u.length;++n){var i=u[n];(i.text||t.cmpPos(i.from,i.to))&&e.replaceRange(i.text,i.from,i.to)}}),u.length?{from:u[0].from,to:t.changeEnd(u[u.length-1])}:null}var r=t.Pos;t.defineExtension("wrapParagraph",function(t,n){n=n||{},t||(t=this.getCursor());var o=e(this,t,n);return i(this,r(o.from,0),r(o.to-1),n)}),t.commands.wrapLines=function(t){t.operation(function(){for(var n=t.listSelections(),o=t.lastLine()+1,s=n.length-1;s>=0;s--){var a,l=n[s];if(l.empty()){var c=e(t,l.head,{});a={from:r(c.from,0),to:r(c.to-1)}}else a={from:l.from(),to:l.to()};a.to.line>=o||(o=a.from.line,i(t,a.from,a.to,{}))}})},t.defineExtension("wrapRange",function(t,e,n){return i(this,t,e,n||{})}),t.defineExtension("wrapParagraphsInRange",function(t,n,o){o=o||{};for(var s=this,a=[],l=t.line;l<=n.line;){var c=e(s,r(l,0),o);a.push(c),l=c.to}var u=!1;return a.length&&s.operation(function(){for(var t=a.length-1;t>=0;--t)u=u||i(s,r(a[t].from,0),r(a[t].to-1),o)}),u})});