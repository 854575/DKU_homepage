!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){function e(t,e,n,i){this.cm=t,this.node=e,this.options=n,this.height=i,this.cleared=!1}function n(t){var e=t.getWrapperElement(),n=window.getComputedStyle?window.getComputedStyle(e):e.currentStyle,i=parseInt(n.height),s=t.state.panels={setHeight:e.style.height,heightLeft:i,panels:0,wrapper:document.createElement("div")};e.parentNode.insertBefore(s.wrapper,e);var r=t.hasFocus();s.wrapper.appendChild(e),r&&t.focus(),t._setSize=t.setSize,null!=i&&(t.setSize=function(e,n){if(null==n)return this._setSize(e,n);if(s.setHeight=n,"number"!=typeof n){var r=/^(\d+\.?\d*)px$/.exec(n);r?n=Number(r[1]):(s.wrapper.style.height=n,n=s.wrapper.offsetHeight,s.wrapper.style.height="")}t._setSize(e,s.heightLeft+=n-i),i=n})}function i(t){var e=t.state.panels;t.state.panels=null;var n=t.getWrapperElement();e.wrapper.parentNode.replaceChild(n,e.wrapper),n.style.height=e.setHeight,t.setSize=t._setSize,t.setSize()}t.defineExtension("addPanel",function(t,i){i=i||{},this.state.panels||n(this);var s=this.state.panels,r=s.wrapper,a=this.getWrapperElement();i.after instanceof e&&!i.after.cleared?r.insertBefore(t,i.before.node.nextSibling):i.before instanceof e&&!i.before.cleared?r.insertBefore(t,i.before.node):i.replace instanceof e&&!i.replace.cleared?(r.insertBefore(t,i.replace.node),i.replace.clear()):"bottom"==i.position?r.appendChild(t):"before-bottom"==i.position?r.insertBefore(t,a.nextSibling):"after-top"==i.position?r.insertBefore(t,a):r.insertBefore(t,r.firstChild);var o=i&&i.height||t.offsetHeight;return this._setSize(null,s.heightLeft-=o),s.panels++,new e(this,t,i,o)}),e.prototype.clear=function(){if(!this.cleared){this.cleared=!0;var t=this.cm.state.panels;this.cm._setSize(null,t.heightLeft+=this.height),t.wrapper.removeChild(this.node),0==--t.panels&&i(this.cm)}},e.prototype.changed=function(t){var e=null==t?this.node.offsetHeight:t,n=this.cm.state.panels;this.cm._setSize(null,n.height+=e-this.height),this.height=e}});