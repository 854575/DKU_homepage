!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../lib/codemirror")):"function"==typeof define&&define.amd?define(["../lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";function e(t,e){return t.line==e.line&&t.ch==e.ch}function n(t){F.push(t),F.length>50&&F.shift()}function i(t){return F.length?void(F[F.length-1]+=t):n(t)}function r(t){return F[F.length-(t?Math.min(t,1):1)]||""}function o(){return F.length>1&&F.pop(),r()}function s(t,r,o,s,a){null==a&&(a=t.getRange(r,o)),s&&H&&H.cm==t&&e(r,H.pos)&&t.isClean(H.gen)?i(a):n(a),t.replaceRange("",r,o,"+delete"),H=s?{cm:t,pos:r,gen:t.changeGeneration()}:null}function a(t,e,n){return t.findPosH(e,n,"char",!0)}function l(t,e,n){return t.findPosH(e,n,"word",!0)}function c(t,e,n){return t.findPosV(e,n,"line",t.doc.sel.goalColumn)}function u(t,e,n){return t.findPosV(e,n,"page",t.doc.sel.goalColumn)}function d(t,e,n){for(var i=e.line,r=t.getLine(i),o=/\S/.test(n<0?r.slice(0,e.ch):r.slice(e.ch)),s=t.firstLine(),a=t.lastLine();;){if(i+=n,i<s||i>a)return t.clipPos(D(i-n,n<0?0:null));r=t.getLine(i);var l=/\S/.test(r);if(l)o=!0;else if(o)return D(i,0)}}function h(t,e,n){for(var i=e.line,r=e.ch,o=t.getLine(e.line),s=!1;;){var a=o.charAt(r+(n<0?-1:0));if(a){if(s&&/[!?.]/.test(a))return D(i,r+(n>0?1:0));s||(s=/\w/.test(a)),r+=n}else{if(i==(n<0?t.firstLine():t.lastLine()))return D(i,r);if(o=t.getLine(i+n),!/\S/.test(o))return D(i,r);i+=n,r=n<0?o.length:0}}}function f(t,n,i){var r;if(t.findMatchingBracket&&(r=t.findMatchingBracket(n,!0))&&r.match&&(r.forward?1:-1)==i)return i>0?D(r.to.line,r.to.ch+1):r.to;for(var o=!0;;o=!1){var s=t.getTokenAt(n),a=D(n.line,i<0?s.start:s.end);if(!(o&&i>0&&s.end==n.ch)&&/\w/.test(s.string))return a;var l=t.findPosH(a,i,"char");if(e(a,l))return n;n=l}}function p(t,e){var n=t.state.emacsPrefix;return n?(w(t),"-"==n?-1:Number(n)):e?null:1}function g(t){var e="string"==typeof t?function(e){e.execCommand(t)}:t;return function(t){var n=p(t);e(t);for(var i=1;i<n;++i)e(t)}}function m(t,n,i,r){var o=p(t);o<0&&(r=-r,o=-o);for(var s=0;s<o;++s){var a=i(t,n,r);if(e(a,n))break;n=a}return n}function v(t,e){var n=function(n){n.extendSelection(m(n,n.getCursor(),t,e))};return n.motion=!0,n}function _(t,e,n){for(var i,r=t.listSelections(),o=r.length;o--;)i=r[o].head,s(t,i,m(t,i,e,n),!0)}function y(t){if(t.somethingSelected()){for(var e,n=t.listSelections(),i=n.length;i--;)e=n[i],s(t,e.anchor,e.head);return!0}}function b(t,e){return t.state.emacsPrefix?void("-"!=e&&(t.state.emacsPrefix+=e)):(t.state.emacsPrefix=e,t.on("keyHandled",x),void t.on("inputRead",C))}function x(t,e){t.state.emacsPrefixMap||q.hasOwnProperty(e)||w(t)}function w(t){t.state.emacsPrefix=null,t.off("keyHandled",x),t.off("inputRead",C)}function C(t,e){var n=p(t);if(n>1&&"+input"==e.origin){for(var i=e.text.join("\n"),r="",o=1;o<n;++o)r+=i;t.replaceSelection(r)}}function k(t){t.state.emacsPrefixMap=!0,t.addKeyMap($),t.on("keyHandled",S),t.on("inputRead",S)}function S(t,e){("string"!=typeof e||!/^\d$/.test(e)&&"Ctrl-U"!=e)&&(t.removeKeyMap($),t.state.emacsPrefixMap=!1,t.off("keyHandled",S),t.off("inputRead",S))}function T(t){t.setCursor(t.getCursor()),t.setExtending(!t.getExtending()),t.on("change",function(){t.setExtending(!1)})}function A(t){t.setExtending(!1),t.setCursor(t.getCursor())}function E(t,e,n){t.openDialog?t.openDialog(e+': <input type="text" style="width: 10em"/>',n,{bottom:!0}):n(prompt(e,""))}function L(t,e){var n=t.getCursor(),i=t.findPosH(n,1,"word");t.replaceRange(e(t.getRange(n,i)),n,i),t.setCursor(i)}function M(t){for(var e=t.getCursor(),n=e.line,i=e.ch,r=[];n>=t.firstLine();){for(var o=t.getLine(n),s=null==i?o.length:i;s>0;){var i=o.charAt(--s);if(")"==i)r.push("(");else if("]"==i)r.push("[");else if("}"==i)r.push("{");else if(/[\(\{\[]/.test(i)&&(!r.length||r.pop()!=i))return t.extendSelection(D(n,s))}--n,i=null}}function j(t){t.execCommand("clearSearch"),A(t)}function N(t){$[t]=function(e){b(e,t)},P["Ctrl-"+t]=function(e){b(e,t)},q["Ctrl-"+t]=!0}for(var D=t.Pos,F=[],H=null,q={"Alt-G":!0,"Ctrl-X":!0,"Ctrl-Q":!0,"Ctrl-U":!0},P=t.keyMap.emacs=t.normalizeKeyMap({"Ctrl-W":function(t){s(t,t.getCursor("start"),t.getCursor("end"))},"Ctrl-K":g(function(t){var e=t.getCursor(),n=t.clipPos(D(e.line)),i=t.getRange(e,n);/\S/.test(i)||(i+="\n",n=D(e.line+1,0)),s(t,e,n,!0,i)}),"Alt-W":function(t){n(t.getSelection()),A(t)},"Ctrl-Y":function(t){var e=t.getCursor();t.replaceRange(r(p(t)),e,e,"paste"),t.setSelection(e,t.getCursor())},"Alt-Y":function(t){t.replaceSelection(o(),"around","paste")},"Ctrl-Space":T,"Ctrl-Shift-2":T,"Ctrl-F":v(a,1),"Ctrl-B":v(a,-1),Right:v(a,1),Left:v(a,-1),"Ctrl-D":function(t){_(t,a,1)},Delete:function(t){y(t)||_(t,a,1)},"Ctrl-H":function(t){_(t,a,-1)},Backspace:function(t){y(t)||_(t,a,-1)},"Alt-F":v(l,1),"Alt-B":v(l,-1),"Alt-D":function(t){_(t,l,1)},"Alt-Backspace":function(t){_(t,l,-1)},"Ctrl-N":v(c,1),"Ctrl-P":v(c,-1),Down:v(c,1),Up:v(c,-1),"Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd",End:"goLineEnd",Home:"goLineStart","Alt-V":v(u,-1),"Ctrl-V":v(u,1),PageUp:v(u,-1),PageDown:v(u,1),"Ctrl-Up":v(d,-1),"Ctrl-Down":v(d,1),"Alt-A":v(h,-1),"Alt-E":v(h,1),"Alt-K":function(t){_(t,h,1)},"Ctrl-Alt-K":function(t){_(t,f,1)},"Ctrl-Alt-Backspace":function(t){_(t,f,-1)},"Ctrl-Alt-F":v(f,1),"Ctrl-Alt-B":v(f,-1),"Shift-Ctrl-Alt-2":function(t){var e=t.getCursor();t.setSelection(m(t,e,f,1),e)},"Ctrl-Alt-T":function(t){var e=f(t,t.getCursor(),-1),n=f(t,e,1),i=f(t,n,1),r=f(t,i,-1);t.replaceRange(t.getRange(r,i)+t.getRange(n,r)+t.getRange(e,n),e,i)},"Ctrl-Alt-U":g(M),"Alt-Space":function(t){for(var e=t.getCursor(),n=e.ch,i=e.ch,r=t.getLine(e.line);n&&/\s/.test(r.charAt(n-1));)--n;for(;i<r.length&&/\s/.test(r.charAt(i));)++i;t.replaceRange(" ",D(e.line,n),D(e.line,i))},"Ctrl-O":g(function(t){t.replaceSelection("\n","start")}),"Ctrl-T":g(function(t){t.execCommand("transposeChars")}),"Alt-C":g(function(t){L(t,function(t){var e=t.search(/\w/);return e==-1?t:t.slice(0,e)+t.charAt(e).toUpperCase()+t.slice(e+1).toLowerCase()})}),"Alt-U":g(function(t){L(t,function(t){return t.toUpperCase()})}),"Alt-L":g(function(t){L(t,function(t){return t.toLowerCase()})}),"Alt-;":"toggleComment","Ctrl-/":g("undo"),"Shift-Ctrl--":g("undo"),"Ctrl-Z":g("undo"),"Cmd-Z":g("undo"),"Shift-Alt-,":"goDocStart","Shift-Alt-.":"goDocEnd","Ctrl-S":"findNext","Ctrl-R":"findPrev","Ctrl-G":j,"Shift-Alt-5":"replace","Alt-/":"autocomplete","Ctrl-J":"newlineAndIndent",Enter:!1,Tab:"indentAuto","Alt-G G":function(t){var e=p(t,!0);return null!=e&&e>0?t.setCursor(e-1):void E(t,"Goto line",function(e){var n;e&&!isNaN(n=Number(e))&&n==(0|n)&&n>0&&t.setCursor(n-1)})},"Ctrl-X Tab":function(t){t.indentSelection(p(t,!0)||t.getOption("indentUnit"))},"Ctrl-X Ctrl-X":function(t){t.setSelection(t.getCursor("head"),t.getCursor("anchor"))},"Ctrl-X Ctrl-S":"save","Ctrl-X Ctrl-W":"save","Ctrl-X S":"saveAll","Ctrl-X F":"open","Ctrl-X U":g("undo"),"Ctrl-X K":"close","Ctrl-X Delete":function(t){s(t,t.getCursor(),h(t,t.getCursor(),1),!0)},"Ctrl-X H":"selectAll","Ctrl-Q Tab":g("insertTab"),"Ctrl-U":k}),$={"Ctrl-G":w},O=0;O<10;++O)N(String(O));N("-")});