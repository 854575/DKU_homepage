!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed"),require("../../addon/mode/overlay")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../htmlmixed/htmlmixed","../../addon/mode/overlay"],t):t(CodeMirror)}(function(t){"use strict";t.defineMode("django:inner",function(){function t(t,e){if(t.match("{{"))return e.tokenize=n,"tag";if(t.match("{%"))return e.tokenize=i,"tag";if(t.match("{#"))return e.tokenize=r,"comment";for(;null!=t.next()&&!t.match(/\{[{%#]/,!1););return null}function e(t,e){return function(n,i){if(!i.escapeNext&&n.eat(t))i.tokenize=e;else{i.escapeNext&&(i.escapeNext=!1);var r=n.next();"\\"==r&&(i.escapeNext=!0)}return"string"}}function n(n,i){if(i.waitDot){if(i.waitDot=!1,"."!=n.peek())return"null";if(n.match(/\.\W+/))return"error";if(n.eat("."))return i.waitProperty=!0,"null";throw Error("Unexpected error while waiting for property.")}if(i.waitPipe){if(i.waitPipe=!1,"|"!=n.peek())return"null";if(n.match(/\.\W+/))return"error";if(n.eat("|"))return i.waitFilter=!0,"null";throw Error("Unexpected error while waiting for filter.")}return i.waitProperty&&(i.waitProperty=!1,n.match(/\b(\w+)\b/))?(i.waitDot=!0,i.waitPipe=!0,"property"):i.waitFilter&&(i.waitFilter=!1,n.match(s))?"variable-2":n.eatSpace()?(i.waitProperty=!1,"null"):n.match(/\b\d+(\.\d+)?\b/)?"number":n.match("'")?(i.tokenize=e("'",i.tokenize),"string"):n.match('"')?(i.tokenize=e('"',i.tokenize),"string"):n.match(/\b(\w+)\b/)&&!i.foundVariable?(i.waitDot=!0,i.waitPipe=!0,"variable"):n.match("}}")?(i.waitProperty=null,i.waitFilter=null,i.waitDot=null,i.waitPipe=null,i.tokenize=t,"tag"):(n.next(),"null")}function i(n,i){if(i.waitDot){if(i.waitDot=!1,"."!=n.peek())return"null";if(n.match(/\.\W+/))return"error";if(n.eat("."))return i.waitProperty=!0,"null";throw Error("Unexpected error while waiting for property.")}if(i.waitPipe){if(i.waitPipe=!1,"|"!=n.peek())return"null";if(n.match(/\.\W+/))return"error";if(n.eat("|"))return i.waitFilter=!0,"null";throw Error("Unexpected error while waiting for filter.")}if(i.waitProperty&&(i.waitProperty=!1,n.match(/\b(\w+)\b/)))return i.waitDot=!0,i.waitPipe=!0,"property";if(i.waitFilter&&(i.waitFilter=!1,n.match(s)))return"variable-2";if(n.eatSpace())return i.waitProperty=!1,"null";if(n.match(/\b\d+(\.\d+)?\b/))return"number";if(n.match("'"))return i.tokenize=e("'",i.tokenize),"string";if(n.match('"'))return i.tokenize=e('"',i.tokenize),"string";if(n.match(l))return"operator";if(n.match(c))return"keyword";var r=n.match(a);return r?("comment"==r[0]&&(i.blockCommentTag=!0),"keyword"):n.match(/\b(\w+)\b/)?(i.waitDot=!0,i.waitPipe=!0,"variable"):n.match("%}")?(i.waitProperty=null,i.waitFilter=null,i.waitDot=null,i.waitPipe=null,i.blockCommentTag?(i.blockCommentTag=!1,i.tokenize=o):i.tokenize=t,"tag"):(n.next(),"null")}function r(e,n){return e.match(/^.*?#\}/)?n.tokenize=t:e.skipToEnd(),"comment"}function o(t,e){return t.match(/\{%\s*endcomment\s*%\}/,!1)?(e.tokenize=i,t.match("{%"),"tag"):(t.next(),"comment")}var a=["block","endblock","for","endfor","true","false","filter","endfilter","loop","none","self","super","if","elif","endif","as","else","import","with","endwith","without","context","ifequal","endifequal","ifnotequal","endifnotequal","extends","include","load","comment","endcomment","empty","url","static","trans","blocktrans","endblocktrans","now","regroup","lorem","ifchanged","endifchanged","firstof","debug","cycle","csrf_token","autoescape","endautoescape","spaceless","endspaceless","ssi","templatetag","verbatim","endverbatim","widthratio"],s=["add","addslashes","capfirst","center","cut","date","default","default_if_none","dictsort","dictsortreversed","divisibleby","escape","escapejs","filesizeformat","first","floatformat","force_escape","get_digit","iriencode","join","last","length","length_is","linebreaks","linebreaksbr","linenumbers","ljust","lower","make_list","phone2numeric","pluralize","pprint","random","removetags","rjust","safe","safeseq","slice","slugify","stringformat","striptags","time","timesince","timeuntil","title","truncatechars","truncatechars_html","truncatewords","truncatewords_html","unordered_list","upper","urlencode","urlize","urlizetrunc","wordcount","wordwrap","yesno"],l=["==","!=","<",">","<=",">="],c=["in","not","or","and"];return a=new RegExp("^\\b("+a.join("|")+")\\b"),s=new RegExp("^\\b("+s.join("|")+")\\b"),l=new RegExp("^\\b("+l.join("|")+")\\b"),c=new RegExp("^\\b("+c.join("|")+")\\b"),{startState:function(){return{tokenize:t}},token:function(t,e){return e.tokenize(t,e)},blockCommentStart:"{% comment %}",blockCommentEnd:"{% endcomment %}"}}),t.defineMode("django",function(e){var n=t.getMode(e,"text/html"),i=t.getMode(e,"django:inner");return t.overlayMode(n,i)}),t.defineMIME("text/x-django","django")});