!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("smarty",function(t,n){function i(e,t){return u=t,e}function r(e,t,n){return t.tokenize=n,n(e,t)}function o(e,t){return null==t&&(t=e.pos),3===h&&"{"==f&&(t==e.string.length||/\s/.test(e.string.charAt(t)))}function a(e,t){for(var n=e.string,i=e.pos;;){var a=n.indexOf(f,i);if(i=a+f.length,a==-1||!o(e,a+f.length))break}if(a==e.pos)return e.match(f),e.eat("*")?r(e,t,c("comment","*"+d)):(t.depth++,t.tokenize=s,u="startTag","tag");a>-1&&(e.string=n.slice(0,a));var l=p.token(e,t.base);return a>-1&&(e.string=n),l}function s(e,t){if(e.match(d,!0))return 3===h?(t.depth--,t.depth<=0&&(t.tokenize=a)):t.tokenize=a,i("tag",null);if(e.match(f,!0))return t.depth++,i("tag","startTag");var n=e.next();if("$"==n)return e.eatWhile(g.validIdentifier),i("variable-2","variable");if("|"==n)return i("operator","pipe");if("."==n)return i("operator","property");if(g.stringChar.test(n))return t.tokenize=l(n),i("string","string");if(g.operatorChars.test(n))return e.eatWhile(g.operatorChars),i("operator","operator");if("["==n||"]"==n)return i("bracket","bracket");if("("==n||")"==n)return i("bracket","operator");if(/\d/.test(n))return e.eatWhile(/\d/),i("number","number");if("variable"==t.last){if("@"==n)return e.eatWhile(g.validIdentifier),i("property","property");if("|"==n)return e.eatWhile(g.validIdentifier),i("qualifier","modifier")}else{if("pipe"==t.last)return e.eatWhile(g.validIdentifier),i("qualifier","modifier");if("whitespace"==t.last)return e.eatWhile(g.validIdentifier),i("attribute","modifier")}if("property"==t.last)return e.eatWhile(g.validIdentifier),i("property",null);if(/\s/.test(n))return u="whitespace",null;var r="";"/"!=n&&(r+=n);for(var o=null;o=e.eat(g.validIdentifier);)r+=o;for(var s=0,c=m.length;s<c;s++)if(m[s]==r)return i("keyword","keyword");return/\s/.test(n)?null:i("tag","tag")}function l(e){return function(t,n){for(var i=null,r=null;!t.eol();){if(r=t.peek(),t.next()==e&&"\\"!==i){n.tokenize=s;break}i=r}return"string"}}function c(e,t){return function(n,i){for(;!n.eol();){if(n.match(t)){i.tokenize=a;break}n.next()}return e}}var u,d=n.rightDelimiter||"}",f=n.leftDelimiter||"{",h=n.version||2,p=e.getMode(t,n.baseMode||"null"),m=["debug","extends","function","include","literal"],g={operatorChars:/[+\-*&%=<>!?]/,validIdentifier:/[a-zA-Z0-9_]/,stringChar:/['"]/};return{startState:function(){return{base:e.startState(p),tokenize:a,last:null,depth:0}},copyState:function(t){return{base:e.copyState(p,t.base),tokenize:t.tokenize,last:t.last,depth:t.depth}},innerMode:function(e){if(e.tokenize==a)return{mode:p,state:e.base}},token:function(e,t){var n=t.tokenize(e,t);return t.last=u,n},indent:function(t,n){return t.tokenize==a&&p.indent?p.indent(t.base,n):e.Pass},blockCommentStart:f+"*",blockCommentEnd:"*"+d}}),e.defineMIME("text/x-smarty","smarty")});