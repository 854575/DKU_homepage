!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";t.defineMode("coffeescript",function(t,e){function n(t){return new RegExp("^(("+t.join(")|(")+"))\\b")}function i(t,e){if(t.sol()){null===e.scope.align&&(e.scope.align=!1);var n=e.scope.offset;if(t.eatSpace()){var i=t.indentation();return i>n&&"coffee"==e.scope.type?"indent":i<n?"dedent":null}n>0&&a(t,e)}if(t.eatSpace())return null;var s=t.peek();if(t.match("####"))return t.skipToEnd(),"comment";if(t.match("###"))return e.tokenize=o,e.tokenize(t,e);if("#"===s)return t.skipToEnd(),"comment";if(t.match(/^-?[0-9\.]/,!1)){var l=!1;if(t.match(/^-?\d*\.\d+(e[\+\-]?\d+)?/i)&&(l=!0),t.match(/^-?\d+\.\d*/)&&(l=!0),t.match(/^-?\.\d+/)&&(l=!0),l)return"."==t.peek()&&t.backUp(1),"number";var g=!1;if(t.match(/^-?0x[0-9a-f]+/i)&&(g=!0),t.match(/^-?[1-9]\d*(e[\+\-]?\d+)?/)&&(g=!0),t.match(/^-?0(?![\dx])/i)&&(g=!0),g)return"number"}if(t.match(y))return e.tokenize=r(t.current(),!1,"string"),e.tokenize(t,e);if(t.match(b)){if("/"!=t.current()||t.match(/^.*\//,!1))return e.tokenize=r(t.current(),!0,"string-2"),e.tokenize(t,e);t.backUp(1)}return t.match(u)||t.match(p)?"operator":t.match(d)?"punctuation":t.match(x)?"atom":t.match(f)||e.prop&&t.match(h)?"property":t.match(v)?"keyword":t.match(h)?"variable":(t.next(),c)}function r(t,n,r){return function(o,s){for(;!o.eol();)if(o.eatWhile(/[^'"\/\\]/),o.eat("\\")){if(o.next(),n&&o.eol())return r}else{if(o.match(t))return s.tokenize=i,r;o.eat(/['"\/]/)}return n&&(e.singleLineStringErrors?r=c:s.tokenize=i),r}}function o(t,e){for(;!t.eol();){if(t.eatWhile(/[^#]/),t.match("###")){e.tokenize=i;break}t.eatWhile("#")}return"comment"}function s(e,n,i){i=i||"coffee";for(var r=0,o=!1,s=null,a=n.scope;a;a=a.prev)if("coffee"===a.type||"}"==a.type){r=a.offset+t.indentUnit;break}"coffee"!==i?(o=null,s=e.column()+e.current().length):n.scope.align&&(n.scope.align=!1),n.scope={offset:r,type:i,prev:n.scope,align:o,alignOffset:s}}function a(t,e){if(e.scope.prev){if("coffee"===e.scope.type){for(var n=t.indentation(),i=!1,r=e.scope;r;r=r.prev)if(n===r.offset){i=!0;break}if(!i)return!0;for(;e.scope.prev&&e.scope.offset!==n;)e.scope=e.scope.prev;return!1}return e.scope=e.scope.prev,!1}}function l(t,e){var n=e.tokenize(t,e),i=t.current();"return"===i&&(e.dedent=!0),(("->"===i||"=>"===i)&&t.eol()||"indent"===n)&&s(t,e);var r="[({".indexOf(i);if(r!==-1&&s(t,e,"])}".slice(r,r+1)),g.exec(i)&&s(t,e),"then"==i&&a(t,e),"dedent"===n&&a(t,e))return c;if(r="])}".indexOf(i),r!==-1){for(;"coffee"==e.scope.type&&e.scope.prev;)e.scope=e.scope.prev;e.scope.type==i&&(e.scope=e.scope.prev)}return e.dedent&&t.eol()&&("coffee"==e.scope.type&&e.scope.prev&&(e.scope=e.scope.prev),e.dedent=!1),n}var c="error",u=/^(?:->|=>|\+[+=]?|-[\-=]?|\*[\*=]?|\/[\/=]?|[=!]=|<[><]?=?|>>?=?|%=?|&=?|\|=?|\^=?|\~|!|\?|(or|and|\|\||&&|\?)=)/,d=/^(?:[()\[\]{},:`=;]|\.\.?\.?)/,h=/^[_A-Za-z$][_A-Za-z$0-9]*/,f=/^@[_A-Za-z$][_A-Za-z$0-9]*/,p=n(["and","or","not","is","isnt","in","instanceof","typeof"]),g=["for","while","loop","if","unless","else","switch","try","catch","finally","class"],m=["break","by","continue","debugger","delete","do","in","of","new","return","then","this","@","throw","when","until","extends"],v=n(g.concat(m));g=n(g);var y=/^('{3}|\"{3}|['\"])/,b=/^(\/{3}|\/)/,_=["Infinity","NaN","undefined","null","true","false","on","off","yes","no"],x=n(_),w={startState:function(t){return{tokenize:i,scope:{offset:t||0,type:"coffee",prev:null,align:!1},prop:!1,dedent:0}},token:function(t,e){var n=null===e.scope.align&&e.scope;n&&t.sol()&&(n.align=!1);var i=l(t,e);return i&&"comment"!=i&&(n&&(n.align=!0),e.prop="punctuation"==i&&"."==t.current()),i},indent:function(t,e){if(t.tokenize!=i)return 0;var n=t.scope,r=e&&"])}".indexOf(e.charAt(0))>-1;if(r)for(;"coffee"==n.type&&n.prev;)n=n.prev;var o=r&&n.type===e.charAt(0);return n.align?n.alignOffset-(o?1:0):(o?n.prev:n).offset},lineComment:"#",fold:"indent"};return w}),t.defineMIME("text/x-coffeescript","coffeescript"),t.defineMIME("text/coffeescript","coffeescript")});