!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("../python/python"),require("../stex/stex"),require("../../addon/mode/overlay")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../python/python","../stex/stex","../../addon/mode/overlay"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("rst",function(t,n){var i=/^\*\*[^\*\s](?:[^\*]*[^\*\s])?\*\*/,r=/^\*[^\*\s](?:[^\*]*[^\*\s])?\*/,o=/^``[^`\s](?:[^`]*[^`\s])``/,a=/^(?:[\d]+(?:[\.,]\d+)*)/,s=/^(?:\s\+[\d]+(?:[\.,]\d+)*)/,l=/^(?:\s\-[\d]+(?:[\.,]\d+)*)/,c="[Hh][Tt][Tt][Pp][Ss]?://",u="(?:[\\d\\w.-]+)\\.(?:\\w{2,6})",d="(?:/[\\d\\w\\#\\%\\&\\-\\.\\,\\/\\:\\=\\?\\~]+)*",f=new RegExp("^"+c+u+d),h={token:function(e){if(e.match(i)&&e.match(/\W+|$/,!1))return"strong";if(e.match(r)&&e.match(/\W+|$/,!1))return"em";if(e.match(o)&&e.match(/\W+|$/,!1))return"string-2";if(e.match(a))return"number";if(e.match(s))return"positive";if(e.match(l))return"negative";if(e.match(f))return"link";for(;!(null==e.next()||e.match(i,!1)||e.match(r,!1)||e.match(o,!1)||e.match(a,!1)||e.match(s,!1)||e.match(l,!1)||e.match(f,!1)););return null}},p=e.getMode(t,n.backdrop||"rst-base");return e.overlayMode(p,h,!0)},"python","stex"),e.defineMode("rst-base",function(t){function n(e){var t=Array.prototype.slice.call(arguments,1);return e.replace(/{(\d+)}/g,function(e,n){return"undefined"!=typeof t[n]?t[n]:e})}function i(t,n){var o=null;if(t.sol()&&t.match(Y,!1))u(n,l,{mode:h,local:e.startState(h)});else if(t.sol()&&t.match(T))u(n,r),o="meta";else if(t.sol()&&t.match(S))u(n,i),o="header";else if(f(n)==$||t.match($,!1))switch(d(n)){case 0:u(n,i,c($,1)),t.match(/^:/),o="meta";break;case 1:u(n,i,c($,2)),t.match(b),o="keyword",t.current().match(/^(?:math|latex)/)&&(n.tmp_stex=!0);break;case 2:u(n,i,c($,3)),t.match(/^:`/),o="meta";break;case 3:if(n.tmp_stex&&(n.tmp_stex=void 0,n.tmp={mode:p,local:e.startState(p)}),n.tmp){if("`"==t.peek()){u(n,i,c($,4)),n.tmp=void 0;break}o=n.tmp.mode.token(t,n.tmp.local);break}u(n,i,c($,4)),t.match(C),o="string";break;case 4:u(n,i,c($,5)),t.match(/^`/),o="meta";break;case 5:u(n,i,c($,6)),t.match(v);break;default:u(n,i)}else if(f(n)==P||t.match(P,!1))switch(d(n)){case 0:u(n,i,c(P,1)),t.match(/^`/),o="meta";break;case 1:u(n,i,c(P,2)),t.match(C),o="string";break;case 2:u(n,i,c(P,3)),t.match(/^`:/),o="meta";break;case 3:u(n,i,c(P,4)),t.match(b),o="keyword";break;case 4:u(n,i,c(P,5)),t.match(/^:/),o="meta";break;case 5:u(n,i,c(P,6)),t.match(v);break;default:u(n,i)}else if(f(n)==F||t.match(F,!1))switch(d(n)){case 0:u(n,i,c(F,1)),t.match(/^:/),o="meta";break;case 1:u(n,i,c(F,2)),t.match(b),o="keyword";break;case 2:u(n,i,c(F,3)),t.match(/^:/),o="meta";break;case 3:u(n,i,c(F,4)),t.match(v);break;default:u(n,i)}else if(f(n)==I||t.match(I,!1))switch(d(n)){case 0:u(n,i,c(I,1)),t.match(H),o="variable-2";break;case 1:u(n,i,c(I,2)),t.match(/^_?_?/)&&(o="link");break;default:u(n,i)}else if(t.match(D))u(n,i),o="quote";else if(t.match(O))u(n,i),o="quote";else if(t.match(R))u(n,i),t.peek()&&!t.peek().match(/^\W$/)||(o="link");else if(f(n)==j||t.match(j,!1))switch(d(n)){case 0:!t.peek()||t.peek().match(/^\W$/)?u(n,i,c(j,1)):t.match(j);break;case 1:u(n,i,c(j,2)),t.match(/^`/),o="link";break;case 2:u(n,i,c(j,3)),t.match(C);break;case 3:u(n,i,c(j,4)),t.match(/^`_/),o="link";break;default:u(n,i)}else t.match(X)?u(n,a):t.next()&&u(n,i);return o}function r(t,n){var a=null;if(f(n)==M||t.match(M,!1))switch(d(n)){case 0:u(n,r,c(M,1)),t.match(H),a="variable-2";break;case 1:u(n,r,c(M,2)),t.match(W);break;case 2:u(n,r,c(M,3)),t.match(B),a="keyword";break;case 3:u(n,r,c(M,4)),t.match(U),a="meta";break;default:u(n,i)}else if(f(n)==A||t.match(A,!1))switch(d(n)){case 0:u(n,r,c(A,1)),t.match(q),a="keyword",t.current().match(/^(?:math|latex)/)?n.tmp_stex=!0:t.current().match(/^python/)&&(n.tmp_py=!0);break;case 1:u(n,r,c(A,2)),t.match(z),a="meta",(t.match(/^latex\s*$/)||n.tmp_stex)&&(n.tmp_stex=void 0,u(n,l,{mode:p,local:e.startState(p)}));break;case 2:u(n,r,c(A,3)),(t.match(/^python\s*$/)||n.tmp_py)&&(n.tmp_py=void 0,u(n,l,{mode:h,local:e.startState(h)}));break;default:u(n,i)}else if(f(n)==E||t.match(E,!1))switch(d(n)){case 0:u(n,r,c(E,1)),t.match(V),t.match(G),a="link";break;case 1:u(n,r,c(E,2)),t.match(K),a="meta";break;default:u(n,i)}else t.match(L)?(u(n,i),a="quote"):t.match(N)?(u(n,i),a="quote"):(t.eatSpace(),t.eol()?u(n,i):(t.skipToEnd(),u(n,o),a="comment"));return a}function o(e,t){return s(e,t,"comment")}function a(e,t){return s(e,t,"meta")}function s(e,t,n){return e.eol()||e.eatSpace()?(e.skipToEnd(),n):(u(t,i),null)}function l(e,t){return t.ctx.mode&&t.ctx.local?e.sol()?(e.eatSpace()||u(t,i),null):t.ctx.mode.token(e,t.ctx.local):(u(t,i),null)}function c(e,t,n,i){return{phase:e,stage:t,mode:n,local:i}}function u(e,t,n){e.tok=t,e.ctx=n||{}}function d(e){return e.ctx.stage||0}function f(e){return e.ctx.phase}var h=e.getMode(t,"python"),p=e.getMode(t,"stex"),m="\\s+",g="(?:\\s*|\\W|$)",v=new RegExp(n("^{0}",g)),y="(?:[^\\W\\d_](?:[\\w!\"#$%&'()\\*\\+,\\-\\./:;<=>\\?]*[^\\W_])?)",b=new RegExp(n("^{0}",y)),_="(?:[^\\W\\d_](?:[\\w\\s!\"#$%&'()\\*\\+,\\-\\./:;<=>\\?]*[^\\W_])?)",x=n("(?:{0}|`{1}`)",y,_),k="(?:[^\\s\\|](?:[^\\|]*[^\\s\\|])?)",w="(?:[^\\`]+)",C=new RegExp(n("^{0}",w)),S=new RegExp("^([!'#$%&\"()*+,-./:;<=>?@\\[\\\\\\]^_`{|}~])\\1{3,}\\s*$"),T=new RegExp(n("^\\.\\.{0}",m)),E=new RegExp(n("^_{0}:{1}|^__:{1}",x,g)),A=new RegExp(n("^{0}::{1}",x,g)),M=new RegExp(n("^\\|{0}\\|{1}{2}::{3}",k,m,x,g)),L=new RegExp(n("^\\[(?:\\d+|#{0}?|\\*)]{1}",x,g)),N=new RegExp(n("^\\[{0}\\]{1}",x,g)),I=new RegExp(n("^\\|{0}\\|",k)),D=new RegExp(n("^\\[(?:\\d+|#{0}?|\\*)]_",x)),O=new RegExp(n("^\\[{0}\\]_",x)),R=new RegExp(n("^{0}__?",x)),j=new RegExp(n("^`{0}`_",w)),$=new RegExp(n("^:{0}:`{1}`{2}",y,w,g)),P=new RegExp(n("^`{1}`:{0}:{2}",y,w,g)),F=new RegExp(n("^:{0}:{1}",y,g)),q=new RegExp(n("^{0}",x)),z=new RegExp(n("^::{0}",g)),H=new RegExp(n("^\\|{0}\\|",k)),W=new RegExp(n("^{0}",m)),B=new RegExp(n("^{0}",x)),U=new RegExp(n("^::{0}",g)),V=new RegExp("^_"),G=new RegExp(n("^{0}|_",x)),K=new RegExp(n("^:{0}",g)),X=new RegExp("^::\\s*$"),Y=new RegExp("^\\s+(?:>>>|In \\[\\d+\\]:)\\s");return{startState:function(){return{tok:i,ctx:c(void 0,0)}},copyState:function(t){var n=t.ctx,i=t.tmp;return n.local&&(n={mode:n.mode,local:e.copyState(n.mode,n.local)}),i&&(i={mode:i.mode,local:e.copyState(i.mode,i.local)}),{tok:t.tok,ctx:n,tmp:i}},innerMode:function(e){return e.tmp?{state:e.tmp.local,mode:e.tmp.mode}:e.ctx.mode?{state:e.ctx.local,mode:e.ctx.mode}:null},token:function(e,t){return t.tok(e,t)}}},"python","stex"),e.defineMIME("text/x-rst","rst")});