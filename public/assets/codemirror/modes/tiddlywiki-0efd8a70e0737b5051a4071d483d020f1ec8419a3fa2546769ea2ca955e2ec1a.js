!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("tiddlywiki",function(){function e(e,t,n){return t.tokenize=n,n(e,t)}function t(t,u){var x=t.sol(),k=t.peek();if(u.block=!1,x&&/[<\/\*{}\-]/.test(k)){if(t.match(_))return u.block=!0,e(t,u,r);if(t.match(m))return"quote";if(t.match(h)||t.match(p))return"comment";if(t.match(g)||t.match(v)||t.match(b)||t.match(y))return"comment";if(t.match(f))return"hr"}if(t.next(),x&&/[\/\*!#;:>|]/.test(k)){if("!"==k)return t.skipToEnd(),"header";if("*"==k)return t.eatWhile("*"),"comment";if("#"==k)return t.eatWhile("#"),"comment";if(";"==k)return t.eatWhile(";"),"comment";if(":"==k)return t.eatWhile(":"),"comment";if(">"==k)return t.eatWhile(">"),"quote";if("|"==k)return"header"}if("{"==k&&t.match(/\{\{/))return e(t,u,r);if(/[hf]/i.test(k)&&/[ti]/i.test(t.peek())&&t.match(/\b(ttps?|tp|ile):\/\/[\-A-Z0-9+&@#\/%?=~_|$!:,.;]*[A-Z0-9+&@#\/%=~_|$]/i))return"link";if('"'==k)return"string";if("~"==k)return"brace";if(/[\[\]]/.test(k)&&t.match(k))return"brace";if("@"==k)return t.eatWhile(d),"link";if(/\d/.test(k))return t.eatWhile(/\d/),"number";if("/"==k){if(t.eat("%"))return e(t,u,n);if(t.eat("/"))return e(t,u,o)}if("_"==k&&t.eat("_"))return e(t,u,a);if("-"==k&&t.eat("-")){if(" "!=t.peek())return e(t,u,s);if(" "==t.peek())return"brace"}return"'"==k&&t.eat("'")?e(t,u,i):"<"==k&&t.eat("<")?e(t,u,l):(t.eatWhile(/[\w\$_]/),c.propertyIsEnumerable(t.current())?"keyword":null)}function n(e,n){for(var i,r=!1;i=e.next();){if("/"==i&&r){n.tokenize=t;break}r="%"==i}return"comment"}function i(e,n){for(var i,r=!1;i=e.next();){if("'"==i&&r){n.tokenize=t;break}r="'"==i}return"strong"}function r(e,n){var i=n.block;return i&&e.current()?"comment":!i&&e.match(k)?(n.tokenize=t,"comment"):i&&e.sol()&&e.match(x)?(n.tokenize=t,"comment"):(e.next(),"comment")}function o(e,n){for(var i,r=!1;i=e.next();){if("/"==i&&r){n.tokenize=t;break}r="/"==i}return"em"}function a(e,n){for(var i,r=!1;i=e.next();){if("_"==i&&r){n.tokenize=t;break}r="_"==i}return"underlined"}function s(e,n){for(var i,r=!1;i=e.next();){if("-"==i&&r){n.tokenize=t;break}r="-"==i}return"strikethrough"}function l(e,n){if("<<"==e.current())return"macro";var i=e.next();return i?">"==i&&">"==e.peek()?(e.next(),n.tokenize=t,"macro"):(e.eatWhile(/[\w\$_]/),u.propertyIsEnumerable(e.current())?"keyword":null):(n.tokenize=t,null)}var c={},u={allTags:!0,closeAll:!0,list:!0,newJournal:!0,newTiddler:!0,permaview:!0,saveChanges:!0,search:!0,slider:!0,tabs:!0,tag:!0,tagging:!0,tags:!0,tiddler:!0,timeline:!0,today:!0,version:!0,option:!0,"with":!0,filter:!0},d=/[\w_\-]/i,f=/^\-\-\-\-+$/,h=/^\/\*\*\*$/,p=/^\*\*\*\/$/,m=/^<<<$/,g=/^\/\/\{\{\{$/,v=/^\/\/\}\}\}$/,b=/^<!--\{\{\{-->$/,y=/^<!--\}\}\}-->$/,_=/^\{\{\{$/,x=/^\}\}\}$/,k=/.*?\}\}\}/;return{startState:function(){return{tokenize:t}},token:function(e,t){if(e.eatSpace())return null;var n=t.tokenize(e,t);return n}}}),e.defineMIME("text/x-tiddlywiki","tiddlywiki")});