!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";t.defineMIME("text/x-erlang","erlang"),t.defineMode("erlang",function(e){function n(t,e){if(e.in_string)return e.in_string=!o(t),u(e,t,"string");if(e.in_atom)return e.in_atom=!a(t),u(e,t,"atom");if(t.eatSpace())return u(e,t,"whitespace");if(!p(e)&&t.match(/-\s*[a-z\xdf-\xf6\xf8-\xff][\w\xd8-\xde\xc0-\xd6\xdf-\xf6\xf8-\xff]*/))return c(t.current(),T)?u(e,t,"type"):u(e,t,"attribute");var n=t.next();if("%"==n)return t.skipToEnd(),u(e,t,"comment");if(":"==n)return u(e,t,"colon");if("?"==n)return t.eatSpace(),t.eatWhile(q),u(e,t,"macro");if("#"==n)return t.eatSpace(),t.eatWhile(q),u(e,t,"record");if("$"==n)return"\\"!=t.next()||t.match(H)?u(e,t,"number"):u(e,t,"error");if("."==n)return u(e,t,"dot");if("'"==n){if(!(e.in_atom=!a(t))){if(t.match(/\s*\/\s*[0-9]/,!1))return t.match(/\s*\/\s*[0-9]/,!0),u(e,t,"fun");if(t.match(/\s*\(/,!1)||t.match(/\s*:/,!1))return u(e,t,"function")}return u(e,t,"atom")}if('"'==n)return e.in_string=!o(t),u(e,t,"string");if(/[A-Z_\xd8-\xde\xc0-\xd6]/.test(n))return t.eatWhile(q),u(e,t,"variable");if(/[a-z_\xdf-\xf6\xf8-\xff]/.test(n)){if(t.eatWhile(q),t.match(/\s*\/\s*[0-9]/,!1))return t.match(/\s*\/\s*[0-9]/,!0),u(e,t,"fun");var s=t.current();return c(s,E)?u(e,t,"keyword"):c(s,L)?u(e,t,"operator"):t.match(/\s*\(/,!1)?!c(s,R)||":"==p(e).token&&"erlang"!=p(e,2).token?c(s,P)?u(e,t,"guard"):u(e,t,"function"):u(e,t,"builtin"):":"==l(t)?"erlang"==s?u(e,t,"builtin"):u(e,t,"function"):c(s,["true","false"])?u(e,t,"boolean"):u(e,t,"atom")}var d=/[0-9]/,f=/[0-9a-zA-Z]/;return d.test(n)?(t.eatWhile(d),t.eat("#")?t.eatWhile(f)||t.backUp(1):t.eat(".")&&(t.eatWhile(d)?t.eat(/[eE]/)&&(t.eat(/[-+]/)?t.eatWhile(d)||t.backUp(2):t.eatWhile(d)||t.backUp(1)):t.backUp(1)),u(e,t,"number")):i(t,j,O)?u(e,t,"open_paren"):i(t,I,F)?u(e,t,"close_paren"):r(t,A,M)?u(e,t,"separator"):r(t,N,D)?u(e,t,"operator"):u(e,t,null)}function i(t,e,n){if(1==t.current().length&&e.test(t.current())){for(t.backUp(1);e.test(t.peek());)if(t.next(),c(t.current(),n))return!0;t.backUp(t.current().length-1)}return!1}function r(t,e,n){if(1==t.current().length&&e.test(t.current())){for(;e.test(t.peek());)t.next();for(;0<t.current().length;){if(c(t.current(),n))return!0;t.backUp(1)}t.next()}return!1}function o(t){return s(t,'"',"\\")}function a(t){return s(t,"'","\\")}function s(t,e,n){for(;!t.eol();){var i=t.next();if(i==e)return!0;i==n&&t.next()}return!1}function l(t){var e=t.match(/([\n\s]+|%[^\n]*\n)*(.)/,!1);return e?e.pop():""}function c(t,e){return-1<e.indexOf(t)}function u(t,e,n){switch(m(t,f(n,e)),n){case"atom":return"atom";case"attribute":return"attribute";case"boolean":return"atom";case"builtin":return"builtin";case"close_paren":return null;case"colon":return null;case"comment":return"comment";case"dot":return null;case"error":return"error";case"fun":return"meta";case"function":return"tag";case"guard":return"property";case"keyword":return"keyword";case"macro":return"variable-2";case"number":return"number";case"open_paren":return null;case"operator":return"operator";case"record":return"bracket";case"separator":return null;case"string":return"string";case"type":return"def";case"variable":return"variable";default:return null}}function d(t,e,n,i){return{token:t,column:e,indent:n,type:i}}function f(t,e){return d(e.current(),e.column(),e.indentation(),t)}function h(t){return d(t,0,0,t)}function p(t,e){var n=t.tokenStack.length,i=e?e:1;return!(n<i)&&t.tokenStack[n-i]}function m(t,e){"comment"!=e.type&&"whitespace"!=e.type&&(t.tokenStack=g(t.tokenStack,e),t.tokenStack=v(t.tokenStack))}function g(t,e){var n=t.length-1;return 0<n&&"record"===t[n].type&&"dot"===e.type?t.pop():0<n&&"group"===t[n].type?(t.pop(),t.push(e)):t.push(e),t}function v(t){var e=t.length-1;if("dot"===t[e].type)return[];if("fun"===t[e].type&&"fun"===t[e-1].token)return t.slice(0,e-1);switch(t[t.length-1].token){case"}":return y(t,{g:["{"]});case"]":return y(t,{i:["["]});case")":return y(t,{i:["("]});case">>":return y(t,{i:["<<"]});case"end":return y(t,{i:["begin","case","fun","if","receive","try"]});case",":return y(t,{e:["begin","try","when","->",",","(","[","{","<<"]});case"->":return y(t,{r:["when"],m:["try","if","case","receive"]});case";":return y(t,{E:["case","fun","if","receive","try","when"]});case"catch":return y(t,{e:["try"]});case"of":return y(t,{e:["case"]});case"after":return y(t,{e:["receive","try"]});default:return t}}function y(t,e){for(var n in e)for(var i=t.length-1,r=e[n],o=i-1;-1<o;o--)if(c(t[o].token,r)){var a=t.slice(0,o);switch(n){case"m":return a.concat(t[o]).concat(t[i]);case"r":return a.concat(t[i]);case"i":return a;case"g":return a.concat(h("group"));case"E":return a.concat(t[o]);case"e":return a.concat(t[o])}}return"E"==n?[]:t}function b(n,i){var r,o=e.indentUnit,a=_(i),s=p(n,1),l=p(n,2);return n.in_string||n.in_atom?t.Pass:l?"when"==s.token?s.column+o:"when"===a&&"function"===l.type?l.indent+o:"("===a&&"fun"===s.token?s.column+3:"catch"===a&&(r=k(n,["try"]))?r.column:c(a,["end","after","of"])?(r=k(n,["begin","case","fun","if","receive","try"]),r?r.column:t.Pass):c(a,F)?(r=k(n,O),r?r.column:t.Pass):c(s.token,[",","|","||"])||c(a,[",","|","||"])?(r=x(n),r?r.column+r.token.length:o):"->"==s.token?c(l.token,["receive","case","if","try"])?l.column+o+o:l.column+o:c(s.token,O)?s.column+s.token.length:(r=w(n),S(r)?r.column+o:0):0}function _(t){var e=t.match(/,|[a-z]+|\}|\]|\)|>>|\|+|\(/);return S(e)&&0===e.index?e[0]:""}function x(t){var e=t.tokenStack.slice(0,-1),n=C(e,"type",["open_paren"]);return!!S(e[n])&&e[n]}function w(t){var e=t.tokenStack,n=C(e,"type",["open_paren","separator","keyword"]),i=C(e,"type",["operator"]);return S(n)&&S(i)&&n<i?e[n+1]:!!S(n)&&e[n]}function k(t,e){var n=t.tokenStack,i=C(n,"token",e);return!!S(n[i])&&n[i]}function C(t,e,n){for(var i=t.length-1;-1<i;i--)if(c(t[i][e],n))return i;return!1}function S(t){return t!==!1&&null!=t}var T=["-type","-spec","-export_type","-opaque"],E=["after","begin","catch","case","cond","end","fun","if","let","of","query","receive","try","when"],A=/[\->,;]/,M=["->",";",","],L=["and","andalso","band","bnot","bor","bsl","bsr","bxor","div","not","or","orelse","rem","xor"],N=/[\+\-\*\/<>=\|:!]/,D=["=","+","-","*","/",">",">=","<","=<","=:=","==","=/=","/=","||","<-","!"],j=/[<\(\[\{]/,O=["<<","(","[","{"],I=/[>\)\]\}]/,F=["}","]",")",">>"],P=["is_atom","is_binary","is_bitstring","is_boolean","is_float","is_function","is_integer","is_list","is_number","is_pid","is_port","is_record","is_reference","is_tuple","atom","binary","bitstring","boolean","function","integer","list","number","pid","port","record","reference","tuple"],R=["abs","adler32","adler32_combine","alive","apply","atom_to_binary","atom_to_list","binary_to_atom","binary_to_existing_atom","binary_to_list","binary_to_term","bit_size","bitstring_to_list","byte_size","check_process_code","contact_binary","crc32","crc32_combine","date","decode_packet","delete_module","disconnect_node","element","erase","exit","float","float_to_list","garbage_collect","get","get_keys","group_leader","halt","hd","integer_to_list","internal_bif","iolist_size","iolist_to_binary","is_alive","is_atom","is_binary","is_bitstring","is_boolean","is_float","is_function","is_integer","is_list","is_number","is_pid","is_port","is_process_alive","is_record","is_reference","is_tuple","length","link","list_to_atom","list_to_binary","list_to_bitstring","list_to_existing_atom","list_to_float","list_to_integer","list_to_pid","list_to_tuple","load_module","make_ref","module_loaded","monitor_node","node","node_link","node_unlink","nodes","notalive","now","open_port","pid_to_list","port_close","port_command","port_connect","port_control","pre_loaded","process_flag","process_info","processes","purge_module","put","register","registered","round","self","setelement","size","spawn","spawn_link","spawn_monitor","spawn_opt","split_binary","statistics","term_to_binary","time","throw","tl","trunc","tuple_size","tuple_to_list","unlink","unregister","whereis"],q=/[\w@\xd8-\xde\xc0-\xd6\xdf-\xf6\xf8-\xff]/,H=/[0-7]{1,3}|[bdefnrstv\\"']|\^[a-zA-Z]|x[0-9a-zA-Z]{2}|x{[0-9a-zA-Z]+}/;return{startState:function(){return{tokenStack:[],in_string:!1,in_atom:!1}},token:function(t,e){return n(t,e)},indent:function(t,e){return b(t,e)},lineComment:"%"}})});