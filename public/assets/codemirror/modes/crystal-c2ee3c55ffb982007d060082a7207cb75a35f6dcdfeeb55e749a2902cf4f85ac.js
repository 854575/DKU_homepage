!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";t.defineMode("crystal",function(t){function e(t,e){return new RegExp((e?"":"^")+"(?:"+t.join("|")+")"+(e?"$":"\\b"))}function n(t,e,n){return n.tokenize.push(t),t(e,n)}function i(t,e){if(t.eatSpace())return null;if("\\"!=e.lastToken&&t.match("{%",!1))return n(o("%","%"),t,e);if("\\"!=e.lastToken&&t.match("{{",!1))return n(o("{","}"),t,e);if("#"==t.peek())return t.skipToEnd(),"comment";var i;if(t.match(p))return t.eat(/[?!]/),i=t.current(),t.eat(":")?"atom":"."==e.lastToken?"property":m.test(i)?("abstract"!=e.lastToken&&b.test(i)?"fun"==i&&e.blocks.indexOf("lib")>=0||(e.blocks.push(i),e.currentIndent+=1):x.test(i)&&(e.blocks.pop(),e.currentIndent-=1),k.hasOwnProperty(i)&&e.tokenize.push(k[i]),"keyword"):v.test(i)?"atom":"variable";if(t.eat("@"))return"["==t.peek()?n(r("[","]","meta"),t,e):(t.eat("@"),t.match(p)||t.match(g),"variable-2");if(t.eat("$"))return t.eat(/[0-9]+|\?/)||t.match(p)||t.match(g),"variable-3";if(t.match(g))return"tag";if(t.eat(":"))return t.eat('"')?n(c('"',"atom",!1),t,e):t.match(p)||t.match(g)||t.match(u)||t.match(d)||t.match(h)?"atom":(t.eat(":"),"operator");if(t.eat('"'))return n(c('"',"string",!0),t,e);if("%"==t.peek()){var s,a="string",l=!0;if(t.match("%r"))a="string-2",s=t.next();else if(t.match("%w"))l=!1,s=t.next();else{if(!(s=t.match(/^%([^\w\s=])/)))return t.match(/^%[a-zA-Z0-9_\u009F-\uFFFF]*/)?"meta":"operator";s=s[1]}return S.hasOwnProperty(s)&&(s=S[s]),n(c(s,a,l),t,e)}return t.eat("'")?(t.match(/^(?:[^']|\\(?:[befnrtv0'"]|[0-7]{3}|u(?:[0-9a-fA-F]{4}|\{[0-9a-fA-F]{1,6}\})))/),t.eat("'"),"atom"):t.eat("0")?(t.eat("x")?t.match(/^[0-9a-fA-F]+/):t.eat("o")?t.match(/^[0-7]+/):t.eat("b")&&t.match(/^[01]+/),"number"):t.eat(/\d/)?(t.match(/^\d*(?:\.\d+)?(?:[eE][+-]?\d+)?/),"number"):t.match(u)?(t.eat("="),"operator"):t.match(d)||t.match(f)?"operator":(i=t.match(/[({[]/,!1))?(i=i[0],n(r(i,S[i],null),t,e)):t.eat("\\")?(t.next(),"meta"):(t.next(),null)}function r(t,e,n,o){return function(s,a){if(!o&&s.match(t))return a.tokenize[a.tokenize.length-1]=r(t,e,n,!0),a.currentIndent+=1,n;var l=i(s,a);return s.current()===e&&(a.tokenize.pop(),a.currentIndent-=1,l=n),l}}function o(t,e,n){return function(r,s){return!n&&r.match("{"+t)?(s.currentIndent+=1,s.tokenize[s.tokenize.length-1]=o(t,e,!0),"meta"):r.match(e+"}")?(s.currentIndent-=1,s.tokenize.pop(),"meta"):i(r,s)}}function s(t,e){if(t.eatSpace())return null;var n;if(n=t.match(p)){if("def"==n)return"keyword";t.eat(/[?!]/)}return e.tokenize.pop(),"def"}function a(t,e){return t.eatSpace()?null:(t.match(p)?t.eat(/[!?]/):t.match(u)||t.match(d)||t.match(h),e.tokenize.pop(),"def")}function l(t,e){return t.eatSpace()?null:(t.match(g),e.tokenize.pop(),"def")}function c(t,e,n){return function(i,s){for(var a=!1;i.peek();)if(a)i.next(),a=!1;else{if(i.match("{%",!1))return s.tokenize.push(o("%","%")),e;if(i.match("{{",!1))return s.tokenize.push(o("{","}")),e;if(n&&i.match("#{",!1))return s.tokenize.push(r("#{","}","meta")),e;var l=i.next();if(l==t)return s.tokenize.pop(),e;a="\\"==l}return e}}var u=/^(?:[-+/%|&^]|\*\*?|[<>]{2})/,d=/^(?:[=!]~|===|<=>|[<>=!]=?|[|&]{2}|~)/,h=/^(?:\[\][?=]?)/,f=/^(?:\.(?:\.{2})?|->|[?:])/,p=/^[a-z_\u009F-\uFFFF][a-zA-Z0-9_\u009F-\uFFFF]*/,g=/^[A-Z_\u009F-\uFFFF][a-zA-Z0-9_\u009F-\uFFFF]*/,m=e(["abstract","alias","as","asm","begin","break","case","class","def","do","else","elsif","end","ensure","enum","extend","for","fun","if","ifdef","include","instance_sizeof","lib","macro","module","next","of","out","pointerof","private","protected","rescue","return","require","sizeof","struct","super","then","type","typeof","union","unless","until","when","while","with","yield","__DIR__","__FILE__","__LINE__"]),v=e(["true","false","nil","self"]),y=["def","fun","macro","class","module","struct","lib","enum","union","if","unless","case","while","until","begin","then","do","for","ifdef"],b=e(y),_=["end","else","elsif","rescue","ensure"],x=e(_),w=["\\)","\\}","\\]"],C=new RegExp("^(?:"+w.join("|")+")$"),k={def:a,fun:a,macro:s,"class":l,module:l,struct:l,lib:l,"enum":l,union:l},S={"[":"]","{":"}","(":")","<":">"};return{startState:function(){return{tokenize:[i],currentIndent:0,lastToken:null,blocks:[]}},token:function(t,e){var n=e.tokenize[e.tokenize.length-1](t,e),i=t.current();return n&&"comment"!=n&&(e.lastToken=i),n},indent:function(e,n){return n=n.replace(/^\s*(?:\{%)?\s*|\s*(?:%\})?\s*$/g,""),x.test(n)||C.test(n)?t.indentUnit*(e.currentIndent-1):t.indentUnit*e.currentIndent},fold:"indent",electricInput:e(w.concat(_),!0),lineComment:"#"}}),t.defineMIME("text/x-crystal","crystal")});