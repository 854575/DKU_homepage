!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../htmlmixed/htmlmixed"],e):e(CodeMirror)}(function(e){"use strict";var t=["template","literal","msg","fallbackmsg","let","if","elseif","else","switch","case","default","foreach","ifempty","for","call","param","deltemplate","delcall","log"];e.defineMode("soy",function(n){function i(e){return e[e.length-1]}function r(e,t,n){var i=e.string,r=n.exec(i.substr(e.pos));r&&(e.string=i.substr(0,e.pos+r.index));var o=e.hideFirstChars(t.indent,function(){return t.localMode.token(e,t.localState)});return e.string=i,o}var o=e.getMode(n,"text/plain"),a={html:e.getMode(n,{name:"text/html",multilineTagIndentFactor:2,multilineTagIndentPastTag:!1}),attributes:o,text:o,uri:o,css:e.getMode(n,"text/css"),js:e.getMode(n,{name:"text/javascript",statementIndent:2*n.indentUnit})};return{startState:function(){return{kind:[],kindTag:[],soyState:[],indent:0,localMode:a.html,localState:e.startState(a.html)}},copyState:function(t){return{tag:t.tag,kind:t.kind.concat([]),kindTag:t.kindTag.concat([]),soyState:t.soyState.concat([]),indent:t.indent,localMode:t.localMode,localState:e.copyState(t.localMode,t.localState)}},token:function(o,s){var l;switch(i(s.soyState)){case"comment":return o.match(/^.*?\*\//)?s.soyState.pop():o.skipToEnd(),"comment";case"variable":return o.match(/^}/)?(s.indent-=2*n.indentUnit,s.soyState.pop(),"variable-2"):(o.next(),null);case"tag":if(o.match(/^\/?}/))return"/template"==s.tag||"/deltemplate"==s.tag?s.indent=0:s.indent-=("/}"==o.current()||t.indexOf(s.tag)==-1?2:1)*n.indentUnit,s.soyState.pop(),"keyword";if(o.match(/^([\w?]+)(?==)/)){if("kind"==o.current()&&(l=o.match(/^="([^"]+)/,!1))){var c=l[1];s.kind.push(c),s.kindTag.push(s.tag),s.localMode=a[c]||a.html,s.localState=e.startState(s.localMode)}return"attribute"}return o.match(/^"/)?(s.soyState.push("string"),"string"):(o.next(),null);case"literal":return o.match(/^(?=\{\/literal})/)?(s.indent-=n.indentUnit,s.soyState.pop(),this.token(o,s)):r(o,s,/\{\/literal}/);case"string":var l=o.match(/^.*?("|\\[\s\S])/);return l?'"'==l[1]&&s.soyState.pop():o.skipToEnd(),"string"}return o.match(/^\/\*/)?(s.soyState.push("comment"),"comment"):o.match(o.sol()?/^\s*\/\/.*/:/^\s+\/\/.*/)?"comment":o.match(/^\{\$[\w?]*/)?(s.indent+=2*n.indentUnit,s.soyState.push("variable"),"variable-2"):o.match(/^\{literal}/)?(s.indent+=n.indentUnit,s.soyState.push("literal"),"keyword"):(l=o.match(/^\{([\/@\\]?[\w?]*)/))?("/switch"!=l[1]&&(s.indent+=(/^(\/|(else|elseif|case|default)$)/.test(l[1])&&"switch"!=s.tag?1:2)*n.indentUnit),s.tag=l[1],s.tag=="/"+i(s.kindTag)&&(s.kind.pop(),s.kindTag.pop(),s.localMode=a[i(s.kind)]||a.html,s.localState=e.startState(s.localMode)),s.soyState.push("tag"),"keyword"):r(o,s,/\{|\s+\/\/|\/\*/)},indent:function(t,r){var o=t.indent,a=i(t.soyState);if("comment"==a)return e.Pass;if("literal"==a)/^\{\/literal}/.test(r)&&(o-=n.indentUnit);else{if(/^\s*\{\/(template|deltemplate)\b/.test(r))return 0;/^\{(\/|(fallbackmsg|elseif|else|ifempty)\b)/.test(r)&&(o-=n.indentUnit),"switch"!=t.tag&&/^\{(case|default)\b/.test(r)&&(o-=n.indentUnit),/^\{\/switch\b/.test(r)&&(o-=n.indentUnit)}return o&&t.localMode.indent&&(o+=t.localMode.indent(t.localState,r)),o},innerMode:function(e){return e.soyState.length&&"literal"!=i(e.soyState)?null:{state:e.localState,mode:e.localMode}},electricInput:/^\s*\{(\/|\/template|\/deltemplate|\/switch|fallbackmsg|elseif|else|case|default|ifempty|\/literal\})$/,lineComment:"//",blockCommentStart:"/*",blockCommentEnd:"*/",blockCommentContinue:" * ",fold:"indent"}},"htmlmixed"),e.registerHelper("hintWords","soy",t.concat(["delpackage","namespace","alias","print","css","debugger"])),e.defineMIME("text/x-soy","soy")});